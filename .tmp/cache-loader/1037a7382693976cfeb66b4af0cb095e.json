{"remainingRequest":"C:\\Users\\cherv\\OneDrive\\Рабочий стол\\deltaway.20\\node_modules\\babel-loader\\lib\\index.js??ref--13-2!C:\\Users\\cherv\\OneDrive\\Рабочий стол\\deltaway.20\\src\\apps\\admin\\ui\\pages\\ChatPage\\ChatPage.jsx","dependencies":[{"path":"C:\\Users\\cherv\\OneDrive\\Рабочий стол\\deltaway.20\\src\\apps\\admin\\ui\\pages\\ChatPage\\ChatPage.jsx","mtime":1671546444000},{"path":"C:\\Users\\cherv\\OneDrive\\Рабочий стол\\deltaway.20\\.babelrc","mtime":1671546158000},{"path":"C:\\Users\\cherv\\OneDrive\\Рабочий стол\\deltaway.20\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1671546958000},{"path":"C:\\Users\\cherv\\OneDrive\\Рабочий стол\\deltaway.20\\node_modules\\babel-loader\\lib\\index.js","mtime":1671546956000}],"contextDependencies":[],"result":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _toConsumableArray2 = require('babel-runtime/helpers/toConsumableArray');\n\nvar _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);\n\nvar _defineProperty2 = require('babel-runtime/helpers/defineProperty');\n\nvar _defineProperty3 = _interopRequireDefault(_defineProperty2);\n\nvar _extends3 = require('babel-runtime/helpers/extends');\n\nvar _extends4 = _interopRequireDefault(_extends3);\n\nvar _slicedToArray2 = require('babel-runtime/helpers/slicedToArray');\n\nvar _slicedToArray3 = _interopRequireDefault(_slicedToArray2);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _jsxFileName = 'C:\\\\Users\\\\cherv\\\\OneDrive\\\\\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B\\\\deltaway.20\\\\src\\\\apps\\\\admin\\\\ui\\\\pages\\\\ChatPage\\\\ChatPage.jsx';\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _propTypes = require('prop-types');\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _last = require('@tinkoff/utils/array/last');\n\nvar _last2 = _interopRequireDefault(_last);\n\nvar _findIndex = require('@tinkoff/utils/array/findIndex');\n\nvar _findIndex2 = _interopRequireDefault(_findIndex);\n\nvar _TextField = require('@material-ui/core/TextField/TextField');\n\nvar _TextField2 = _interopRequireDefault(_TextField);\n\nvar _reactRedux = require('react-redux');\n\nvar _ChatPage = require('./ChatPage.css');\n\nvar _ChatPage2 = _interopRequireDefault(_ChatPage);\n\nvar _classnames = require('classnames');\n\nvar _classnames2 = _interopRequireDefault(_classnames);\n\nvar _format = require('date-fns/format');\n\nvar _format2 = _interopRequireDefault(_format);\n\nvar _isToday = require('date-fns/isToday');\n\nvar _isToday2 = _interopRequireDefault(_isToday);\n\nvar _isThisWeek = require('date-fns/isThisWeek');\n\nvar _isThisWeek2 = _interopRequireDefault(_isThisWeek);\n\nvar _messageWebsocket = require('../../../services/messageWebsocket');\n\nvar _messageWebsocket2 = _interopRequireDefault(_messageWebsocket);\n\nvar _getMessageHistory2 = require('../../../services/getMessageHistory');\n\nvar _getMessageHistory3 = _interopRequireDefault(_getMessageHistory2);\n\nvar _getUsers2 = require('../../../services/getUsers');\n\nvar _getUsers3 = _interopRequireDefault(_getUsers2);\n\nvar _editMessage2 = require('../../../services/editMessage');\n\nvar _editMessage3 = _interopRequireDefault(_editMessage2);\n\nvar _getUnvisitedMessageHistory2 = require('../../../services/getUnvisitedMessageHistory');\n\nvar _getUnvisitedMessageHistory3 = _interopRequireDefault(_getUnvisitedMessageHistory2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n    return {\n        getMessageHistory: function getMessageHistory(payload) {\n            return dispatch((0, _getMessageHistory3.default)(payload));\n        },\n        getUsers: function getUsers(payload) {\n            return dispatch((0, _getUsers3.default)(payload));\n        },\n        editMessage: function editMessage(payload) {\n            return dispatch((0, _editMessage3.default)(payload));\n        },\n        getUnvisitedMessageHistory: function getUnvisitedMessageHistory(payload) {\n            return dispatch((0, _getUnvisitedMessageHistory3.default)(payload));\n        }\n    };\n};\n\nvar MainPage = function (_Component) {\n    (0, _inherits3.default)(MainPage, _Component);\n\n    function MainPage(props) {\n        (0, _classCallCheck3.default)(this, MainPage);\n\n        var _this = (0, _possibleConstructorReturn3.default)(this, (MainPage.__proto__ || Object.getPrototypeOf(MainPage)).call(this, props));\n\n        _this.propTypes = {\n            getMessageHistory: _propTypes2.default.func.isRequired,\n            getUsers: _propTypes2.default.func.isRequired,\n            editMessage: _propTypes2.default.func.isRequired,\n            getUnvisitedMessageHistory: _propTypes2.default.func.isRequired\n        };\n\n        _this.filterChatsBySearch = function (chats) {\n            var search = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : _this.state.search;\n\n            return chats.filter(function (messagesByUser) {\n                var user = _this.state.usersMap[messagesByUser.userId];\n                var name = user && (user.name + ' ' + user.surname).toLowerCase();\n\n                return !search || name && name.indexOf(search.toLowerCase()) !== -1;\n            });\n        };\n\n        _this.handleSearchChange = function (event) {\n            var newValue = event.target.value;\n\n            _this.setState({\n                search: newValue,\n                showedMessagesByUsers: _this.filterChatsBySearch(_this.state.messagesByUsers, newValue)\n            });\n        };\n\n        _this.scrollToBottomNewMessage = function () {\n            _this.messagesWrapper.current.classList.remove(_ChatPage2.default.noScrollWrapper);\n            if (_this.messagesWrapper.current.scrollHeight <= _this.messagesWrapper.current.clientHeight) {\n                _this.messagesWrapper.current.classList.add(_ChatPage2.default.noScrollWrapper);\n            } else {\n                _this.messagesWrapper.current.scrollTop = _this.messagesWrapper.current.scrollHeight;\n            }\n        };\n\n        _this.getData = function () {\n            Promise.all([_this.props.getMessageHistory(), _this.props.getUsers()]).then(function (_ref) {\n                var _ref2 = (0, _slicedToArray3.default)(_ref, 2),\n                    messages = _ref2[0],\n                    users = _ref2[1];\n\n                var allUsers = users.payload;\n\n                _this.setState({\n                    users: allUsers,\n                    usersMap: allUsers.reduce(function (result, user) {\n                        return (0, _extends4.default)({}, result, (0, _defineProperty3.default)({}, user.id, user));\n                    }, {})\n                });\n\n                var newMessagesByUsers = allUsers.reduce(function (result, user) {\n                    var currentUserMessages = messages.filter(function (item) {\n                        return user.id === item.senderId || user.id === item.receiverId;\n                    });\n                    var sortedByDateMessages = currentUserMessages.reduce(function (acc, item) {\n                        if (acc[acc.length - 1][0]) {\n                            var currentItemDate = (0, _format2.default)(item.createdAt, 'P');\n                            var currentArrayDate = (0, _format2.default)(acc[acc.length - 1][0].createdAt, 'P');\n\n                            if (currentArrayDate === currentItemDate) {\n                                acc[acc.length - 1].push(item);\n                            } else acc.push([item]);\n                        } else acc[acc.length - 1].push(item);\n\n                        return acc;\n                    }, [[]]);\n                    var unvisitedMessages = currentUserMessages.filter(function (item) {\n                        return item.receiverId === 'admin' && !item.visited;\n                    });\n\n                    return [].concat((0, _toConsumableArray3.default)(result), [{\n                        userId: user.id,\n                        messages: sortedByDateMessages,\n                        unvisitedMessagesCounter: unvisitedMessages.length\n                    }]);\n                }, []).sort(function (prev, next) {\n                    if (!prev.messages[0].length) {\n                        return 1;\n                    }\n                    if (!next.messages[0].length) {\n                        return 1;\n                    }\n                    return (0, _last2.default)(prev.messages[0]).createdAt - (0, _last2.default)(next.messages[0]).createdAt < 0 ? 1 : -1;\n                });\n\n                _this.setState({\n                    activeTabId: newMessagesByUsers[0].userId,\n                    messagesByUsers: newMessagesByUsers,\n                    showedMessagesByUsers: newMessagesByUsers\n                });\n                _this.scrollToBottom();\n            });\n        };\n\n        _this.handleMessage = function (message) {\n            var messagesByUsers = _this.state.messagesByUsers;\n\n            var userId = message.senderId === 'admin' ? message.receiverId : message.senderId;\n\n            var index = (0, _findIndex2.default)(function (messagesByUser) {\n                return messagesByUser.userId === userId;\n            }, messagesByUsers);\n\n            if (index === -1) {\n                messagesByUsers.unshift({ userId: userId, messages: [message] });\n            } else {\n                messagesByUsers[index].messages[messagesByUsers[index].messages.length - 1].push(message);\n                if ((0, _last2.default)((0, _last2.default)(messagesByUsers[index].messages)).receiverId === 'admin') {\n                    messagesByUsers[index].unvisitedMessagesCounter = messagesByUsers[index].unvisitedMessagesCounter + 1;\n                }\n                var messagesByUser = messagesByUsers[index];\n\n                messagesByUsers.splice(index, 1);\n                messagesByUsers.unshift(messagesByUser);\n            }\n\n            _this.setState({\n                messagesByUsers: messagesByUsers,\n                showedMessagesByUsers: _this.filterChatsBySearch(messagesByUsers)\n            }, function () {\n                return _this.scrollToBottomNewMessage();\n            });\n        };\n\n        _this.handleSubmit = function (receiverId) {\n            return function (event) {\n                event.preventDefault();\n                var value = _this.state.value;\n\n\n                _messageWebsocket2.default.sendMessage({\n                    text: value,\n                    receiverId: receiverId\n                });\n\n                _this.setState({\n                    value: '',\n                    activeTabId: receiverId\n                });\n                _this.scrollToBottom();\n            };\n        };\n\n        _this.handleTabClick = function (index, userId) {\n            return function () {\n                var _this$state = _this.state,\n                    messagesByUsers = _this$state.messagesByUsers,\n                    showedMessagesByUsers = _this$state.showedMessagesByUsers;\n\n                var messagesByUsersIndex = (0, _findIndex2.default)(function (messagesByUser) {\n                    return messagesByUser.userId === userId;\n                }, messagesByUsers);\n                messagesByUsers[messagesByUsersIndex] = (0, _extends4.default)({}, messagesByUsers[messagesByUsersIndex], { unvisitedMessagesCounter: 0 });\n                var showedMessagesByUsersIndex = (0, _findIndex2.default)(function (messagesByUser) {\n                    return messagesByUser.userId === userId;\n                }, showedMessagesByUsers);\n                showedMessagesByUsers[showedMessagesByUsersIndex] = (0, _extends4.default)({}, showedMessagesByUsers[showedMessagesByUsersIndex], { unvisitedMessagesCounter: 0 });\n\n                _this.setState({ activeTabId: userId, messagesByUsers: messagesByUsers, showedMessagesByUsers: showedMessagesByUsers });\n                _this.props.editMessage({ id: userId }).then(_this.props.getUnvisitedMessageHistory);\n            };\n        };\n\n        _this.getDateHelper = function (milliseconds) {\n            return (0, _format2.default)(milliseconds, 'd') + ' ' + (0, _format2.default)(milliseconds, 'MMMM');\n        };\n\n        _this.handleChange = function (event) {\n            _this.setState({\n                value: event.target.value\n            });\n        };\n\n        _this.state = {\n            value: '',\n            search: '',\n            messagesByUsers: [],\n            showedMessagesByUsers: [],\n            users: [],\n            activeTabId: null\n        };\n\n        _this.messagesWrapper = _react2.default.createRef();\n        return _this;\n    }\n\n    (0, _createClass3.default)(MainPage, [{\n        key: 'componentDidMount',\n        value: function componentDidMount() {\n            _messageWebsocket2.default.events.on('message', this.handleMessage);\n\n            this.getData();\n        }\n    }, {\n        key: 'componentDidUpdate',\n        value: function componentDidUpdate(prevProps, prevState) {\n            if (prevState.activeTabId !== this.state.activeTabId) {\n                this.scrollToBottom();\n            }\n        }\n    }, {\n        key: 'scrollToBottom',\n        value: function scrollToBottom() {\n            this.messagesWrapper.current.scrollTop = this.messagesWrapper.current.scrollHeight;\n        }\n    }, {\n        key: 'componentWillUnmount',\n        value: function componentWillUnmount() {\n            _messageWebsocket2.default.events.removeListener('message', this.handleMessage);\n        }\n    }, {\n        key: 'render',\n        value: function render() {\n            var _React$createElement,\n                _React$createElement2,\n                _this2 = this,\n                _React$createElement11,\n                _React$createElement23,\n                _React$createElement24,\n                _React$createElement25,\n                _React$createElement26,\n                _React$createElement27,\n                _React$createElement28,\n                _React$createElement29,\n                _React$createElement30,\n                _React$createElement31;\n\n            var _state = this.state,\n                value = _state.value,\n                messagesByUsers = _state.messagesByUsers,\n                showedMessagesByUsers = _state.showedMessagesByUsers,\n                activeTabId = _state.activeTabId,\n                usersMap = _state.usersMap,\n                search = _state.search;\n\n\n            return _react2.default.createElement(\n                'div',\n                (_React$createElement31 = { className: _ChatPage2.default.content, style: { position: 'relative' }, 'data-qa-file': 'ChatPage',\n                    __source: {\n                        fileName: _jsxFileName,\n                        lineNumber: 231\n                    },\n                    __self: this\n                }, (0, _defineProperty3.default)(_React$createElement31, '__self', this), (0, _defineProperty3.default)(_React$createElement31, 'data-qa-file', 'ChatPage'), (0, _defineProperty3.default)(_React$createElement31, 'data-qa-file', 'ChatPage'), _React$createElement31),\n                _react2.default.createElement(\n                    'div',\n                    (_React$createElement2 = {\n                        'data-qa-file': 'ChatPage',\n                        __source: {\n                            fileName: _jsxFileName,\n                            lineNumber: 232\n                        },\n                        __self: this\n                    }, (0, _defineProperty3.default)(_React$createElement2, '__self', this), (0, _defineProperty3.default)(_React$createElement2, 'data-qa-file', 'ChatPage'), (0, _defineProperty3.default)(_React$createElement2, 'data-qa-file', 'ChatPage'), _React$createElement2),\n                    _react2.default.createElement(_TextField2.default, (_React$createElement = {\n                        label: '\\u041F\\u043E\\u0438\\u0441\\u043A \\u043F\\u043E \\u0438\\u043C\\u0435\\u043D\\u0438 \\u043A\\u043B\\u0438\\u0435\\u043D\\u0442\\u0430',\n                        fullWidth: true,\n                        value: search,\n                        onChange: this.handleSearchChange,\n                        margin: 'normal',\n                        variant: 'outlined',\n                        type: 'text',\n                        'data-qa-file': 'ChatPage',\n                        __source: {\n                            fileName: _jsxFileName,\n                            lineNumber: 233\n                        },\n                        __self: this\n                    }, (0, _defineProperty3.default)(_React$createElement, '__self', this), (0, _defineProperty3.default)(_React$createElement, 'data-qa-file', 'ChatPage'), (0, _defineProperty3.default)(_React$createElement, 'data-qa-file', 'ChatPage'), _React$createElement))\n                ),\n                _react2.default.createElement(\n                    'form',\n                    (_React$createElement30 = { className: _ChatPage2.default.messengerContainer, onSubmit: messagesByUsers.length ? this.handleSubmit(activeTabId) : undefined, 'data-qa-file': 'ChatPage',\n                        __source: {\n                            fileName: _jsxFileName,\n                            lineNumber: 243\n                        },\n                        __self: this\n                    }, (0, _defineProperty3.default)(_React$createElement30, '__self', this), (0, _defineProperty3.default)(_React$createElement30, 'data-qa-file', 'ChatPage'), (0, _defineProperty3.default)(_React$createElement30, 'data-qa-file', 'ChatPage'), _React$createElement30),\n                    _react2.default.createElement(\n                        'div',\n                        (_React$createElement11 = { className: _ChatPage2.default.contacts, 'data-qa-file': 'ChatPage',\n                            __source: {\n                                fileName: _jsxFileName,\n                                lineNumber: 244\n                            },\n                            __self: this\n                        }, (0, _defineProperty3.default)(_React$createElement11, '__self', this), (0, _defineProperty3.default)(_React$createElement11, 'data-qa-file', 'ChatPage'), (0, _defineProperty3.default)(_React$createElement11, 'data-qa-file', 'ChatPage'), _React$createElement11),\n                        showedMessagesByUsers.map(function (messagesByUser, i) {\n                            var _React$createElement3, _React$createElement4, _React$createElement5, _React$createElement6, _React$createElement7, _React$createElement8, _React$createElement9, _React$createElement10;\n\n                            var user = usersMap[messagesByUser.userId];\n                            var lastMessage = messagesByUser.messages ? (0, _last2.default)(messagesByUser.messages[messagesByUser.messages.length - 1]) : undefined;\n\n                            return _react2.default.createElement(\n                                'div',\n                                (_React$createElement10 = { className: (0, _classnames2.default)(_ChatPage2.default.contact, (0, _defineProperty3.default)({}, _ChatPage2.default.active, activeTabId === messagesByUser.userId)),\n                                    key: i, onClick: _this2.handleTabClick(i, user.id), 'data-qa-file': 'ChatPage',\n                                    __source: {\n                                        fileName: _jsxFileName,\n                                        lineNumber: 249\n                                    },\n                                    __self: _this2\n                                }, (0, _defineProperty3.default)(_React$createElement10, '__self', _this2), (0, _defineProperty3.default)(_React$createElement10, 'data-qa-file', 'ChatPage'), (0, _defineProperty3.default)(_React$createElement10, 'data-qa-file', 'ChatPage'), _React$createElement10),\n                                _react2.default.createElement(\n                                    'div',\n                                    (_React$createElement8 = { className: _ChatPage2.default.info, 'data-qa-file': 'ChatPage',\n                                        __source: {\n                                            fileName: _jsxFileName,\n                                            lineNumber: 251\n                                        },\n                                        __self: _this2\n                                    }, (0, _defineProperty3.default)(_React$createElement8, '__self', _this2), (0, _defineProperty3.default)(_React$createElement8, 'data-qa-file', 'ChatPage'), (0, _defineProperty3.default)(_React$createElement8, 'data-qa-file', 'ChatPage'), _React$createElement8),\n                                    _react2.default.createElement(\n                                        'h1',\n                                        (_React$createElement3 = { className: _ChatPage2.default.userFullName, 'data-qa-file': 'ChatPage',\n                                            __source: {\n                                                fileName: _jsxFileName,\n                                                lineNumber: 252\n                                            },\n                                            __self: _this2\n                                        }, (0, _defineProperty3.default)(_React$createElement3, '__self', _this2), (0, _defineProperty3.default)(_React$createElement3, 'data-qa-file', 'ChatPage'), (0, _defineProperty3.default)(_React$createElement3, 'data-qa-file', 'ChatPage'), _React$createElement3),\n                                        user.name,\n                                        ' ',\n                                        user.surname\n                                    ),\n                                    _react2.default.createElement(\n                                        'div',\n                                        (_React$createElement7 = { className: _ChatPage2.default.lastMessage, 'data-qa-file': 'ChatPage',\n                                            __source: {\n                                                fileName: _jsxFileName,\n                                                lineNumber: 253\n                                            },\n                                            __self: _this2\n                                        }, (0, _defineProperty3.default)(_React$createElement7, '__self', _this2), (0, _defineProperty3.default)(_React$createElement7, 'data-qa-file', 'ChatPage'), (0, _defineProperty3.default)(_React$createElement7, 'data-qa-file', 'ChatPage'), _React$createElement7),\n                                        lastMessage && lastMessage.senderId === 'admin' && _react2.default.createElement(\n                                            'div',\n                                            (_React$createElement4 = { className: _ChatPage2.default.messageYou, 'data-qa-file': 'ChatPage',\n                                                __source: {\n                                                    fileName: _jsxFileName,\n                                                    lineNumber: 256\n                                                },\n                                                __self: _this2\n                                            }, (0, _defineProperty3.default)(_React$createElement4, '__self', _this2), (0, _defineProperty3.default)(_React$createElement4, 'data-qa-file', 'ChatPage'), (0, _defineProperty3.default)(_React$createElement4, 'data-qa-file', 'ChatPage'), _React$createElement4),\n                                            '\\u0412\\u044B:'\n                                        ),\n                                        lastMessage && _react2.default.createElement(\n                                            'div',\n                                            (_React$createElement5 = { className: _ChatPage2.default.text, 'data-qa-file': 'ChatPage',\n                                                __source: {\n                                                    fileName: _jsxFileName,\n                                                    lineNumber: 258\n                                                },\n                                                __self: _this2\n                                            }, (0, _defineProperty3.default)(_React$createElement5, '__self', _this2), (0, _defineProperty3.default)(_React$createElement5, 'data-qa-file', 'ChatPage'), (0, _defineProperty3.default)(_React$createElement5, 'data-qa-file', 'ChatPage'), _React$createElement5),\n                                            lastMessage.text\n                                        ),\n                                        lastMessage && _react2.default.createElement(\n                                            'div',\n                                            (_React$createElement6 = { className: _ChatPage2.default.date, 'data-qa-file': 'ChatPage',\n                                                __source: {\n                                                    fileName: _jsxFileName,\n                                                    lineNumber: 260\n                                                },\n                                                __self: _this2\n                                            }, (0, _defineProperty3.default)(_React$createElement6, '__self', _this2), (0, _defineProperty3.default)(_React$createElement6, 'data-qa-file', 'ChatPage'), (0, _defineProperty3.default)(_React$createElement6, 'data-qa-file', 'ChatPage'), _React$createElement6),\n                                            (0, _isToday2.default)(lastMessage.createdAt) ? (0, _format2.default)(lastMessage.createdAt, 'HH:mm') : (0, _isThisWeek2.default)(lastMessage.createdAt) ? (0, _format2.default)(lastMessage.createdAt, 'EEEE') : (0, _format2.default)(lastMessage.createdAt, 'P')\n                                        )\n                                    )\n                                ),\n                                messagesByUser.unvisitedMessagesCounter ? _react2.default.createElement(\n                                    'span',\n                                    (_React$createElement9 = { className: _ChatPage2.default.rate, 'data-qa-file': 'ChatPage',\n                                        __source: {\n                                            fileName: _jsxFileName,\n                                            lineNumber: 272\n                                        },\n                                        __self: _this2\n                                    }, (0, _defineProperty3.default)(_React$createElement9, '__self', _this2), (0, _defineProperty3.default)(_React$createElement9, 'data-qa-file', 'ChatPage'), (0, _defineProperty3.default)(_React$createElement9, 'data-qa-file', 'ChatPage'), _React$createElement9),\n                                    messagesByUser.unvisitedMessagesCounter\n                                ) : undefined\n                            );\n                        })\n                    ),\n                    _react2.default.createElement(\n                        'div',\n                        (_React$createElement29 = { className: _ChatPage2.default.messages, 'data-qa-file': 'ChatPage',\n                            __source: {\n                                fileName: _jsxFileName,\n                                lineNumber: 279\n                            },\n                            __self: this\n                        }, (0, _defineProperty3.default)(_React$createElement29, '__self', this), (0, _defineProperty3.default)(_React$createElement29, 'data-qa-file', 'ChatPage'), (0, _defineProperty3.default)(_React$createElement29, 'data-qa-file', 'ChatPage'), _React$createElement29),\n                        _react2.default.createElement(\n                            'div',\n                            (_React$createElement23 = { ref: this.messagesWrapper, className: _ChatPage2.default.messagesWrapper, 'data-qa-file': 'ChatPage',\n                                __source: {\n                                    fileName: _jsxFileName,\n                                    lineNumber: 280\n                                },\n                                __self: this\n                            }, (0, _defineProperty3.default)(_React$createElement23, '__self', this), (0, _defineProperty3.default)(_React$createElement23, 'data-qa-file', 'ChatPage'), (0, _defineProperty3.default)(_React$createElement23, 'data-qa-file', 'ChatPage'), _React$createElement23),\n                            (messagesByUsers.find(function (messagesByUser) {\n                                return messagesByUser.userId === activeTabId;\n                            }) || { messages: [] }).messages.map(function (item, i) {\n                                if (item.length) {\n                                    var _React$createElement22;\n\n                                    return _react2.default.createElement(\n                                        'div',\n                                        (_React$createElement22 = { className: _ChatPage2.default.messagesContainer, 'data-attr': _this2.getDateHelper(item[0].createdAt), 'data-qa-file': 'ChatPage',\n                                            __source: {\n                                                fileName: _jsxFileName,\n                                                lineNumber: 283\n                                            },\n                                            __self: _this2\n                                        }, (0, _defineProperty3.default)(_React$createElement22, '__self', _this2), (0, _defineProperty3.default)(_React$createElement22, 'data-qa-file', 'ChatPage'), (0, _defineProperty3.default)(_React$createElement22, 'data-qa-file', 'ChatPage'), _React$createElement22),\n                                        item.map(function (message, i) {\n                                            var _React$createElement12, _React$createElement13, _React$createElement14, _React$createElement15, _React$createElement16, _React$createElement17, _React$createElement18, _React$createElement19, _React$createElement20, _React$createElement21;\n\n                                            var isMyMessage = message.senderId === 'admin';\n                                            var user = usersMap[message.senderId];\n\n                                            return _react2.default.createElement(\n                                                'div',\n                                                (_React$createElement21 = { key: i, className: (0, _classnames2.default)(_ChatPage2.default.message, (0, _defineProperty3.default)({}, _ChatPage2.default.messageYou, isMyMessage)), 'data-qa-file': 'ChatPage',\n                                                    __source: {\n                                                        fileName: _jsxFileName,\n                                                        lineNumber: 288\n                                                    },\n                                                    __self: _this2\n                                                }, (0, _defineProperty3.default)(_React$createElement21, '__self', _this2), (0, _defineProperty3.default)(_React$createElement21, 'data-qa-file', 'ChatPage'), (0, _defineProperty3.default)(_React$createElement21, 'data-qa-file', 'ChatPage'), _React$createElement21),\n                                                _react2.default.createElement(\n                                                    'div',\n                                                    (_React$createElement20 = { className: _ChatPage2.default.messageContent, 'data-qa-file': 'ChatPage',\n                                                        __source: {\n                                                            fileName: _jsxFileName,\n                                                            lineNumber: 289\n                                                        },\n                                                        __self: _this2\n                                                    }, (0, _defineProperty3.default)(_React$createElement20, '__self', _this2), (0, _defineProperty3.default)(_React$createElement20, 'data-qa-file', 'ChatPage'), (0, _defineProperty3.default)(_React$createElement20, 'data-qa-file', 'ChatPage'), _React$createElement20),\n                                                    _react2.default.createElement(\n                                                        'div',\n                                                        (_React$createElement18 = { className: _ChatPage2.default.messageContentTop, 'data-qa-file': 'ChatPage',\n                                                            __source: {\n                                                                fileName: _jsxFileName,\n                                                                lineNumber: 290\n                                                            },\n                                                            __self: _this2\n                                                        }, (0, _defineProperty3.default)(_React$createElement18, '__self', _this2), (0, _defineProperty3.default)(_React$createElement18, 'data-qa-file', 'ChatPage'), (0, _defineProperty3.default)(_React$createElement18, 'data-qa-file', 'ChatPage'), _React$createElement18),\n                                                        _react2.default.createElement(\n                                                            'div',\n                                                            (_React$createElement12 = { className: _ChatPage2.default.messageName, 'data-qa-file': 'ChatPage',\n                                                                __source: {\n                                                                    fileName: _jsxFileName,\n                                                                    lineNumber: 291\n                                                                },\n                                                                __self: _this2\n                                                            }, (0, _defineProperty3.default)(_React$createElement12, '__self', _this2), (0, _defineProperty3.default)(_React$createElement12, 'data-qa-file', 'ChatPage'), (0, _defineProperty3.default)(_React$createElement12, 'data-qa-file', 'ChatPage'), _React$createElement12),\n                                                            !isMyMessage ? user.name + ' ' + user.surname : 'Админ'\n                                                        ),\n\n                                                        // please check, there is no type in messagesByUser.messages\n                                                        !isMyMessage && _react2.default.createElement('div', (_React$createElement13 = { className: _ChatPage2.default.messageType, 'data-qa-file': 'ChatPage',\n                                                            __source: {\n                                                                fileName: _jsxFileName,\n                                                                lineNumber: 296\n                                                            },\n                                                            __self: _this2\n                                                        }, (0, _defineProperty3.default)(_React$createElement13, '__self', _this2), (0, _defineProperty3.default)(_React$createElement13, 'data-qa-file', 'ChatPage'), (0, _defineProperty3.default)(_React$createElement13, 'data-qa-file', 'ChatPage'), _React$createElement13))\n                                                        //\n                                                        ,\n                                                        _react2.default.createElement(\n                                                            'div',\n                                                            (_React$createElement17 = { className: _ChatPage2.default.messageDate, 'data-qa-file': 'ChatPage',\n                                                                __source: {\n                                                                    fileName: _jsxFileName,\n                                                                    lineNumber: 301\n                                                                },\n                                                                __self: _this2\n                                                            }, (0, _defineProperty3.default)(_React$createElement17, '__self', _this2), (0, _defineProperty3.default)(_React$createElement17, 'data-qa-file', 'ChatPage'), (0, _defineProperty3.default)(_React$createElement17, 'data-qa-file', 'ChatPage'), _React$createElement17),\n                                                            isMyMessage && _react2.default.createElement(\n                                                                'span',\n                                                                (_React$createElement16 = { className: _ChatPage2.default.receivedIcon, 'data-qa-file': 'ChatPage',\n                                                                    __source: {\n                                                                        fileName: _jsxFileName,\n                                                                        lineNumber: 304\n                                                                    },\n                                                                    __self: _this2\n                                                                }, (0, _defineProperty3.default)(_React$createElement16, '__self', _this2), (0, _defineProperty3.default)(_React$createElement16, 'data-qa-file', 'ChatPage'), (0, _defineProperty3.default)(_React$createElement16, 'data-qa-file', 'ChatPage'), _React$createElement16),\n                                                                _react2.default.createElement(\n                                                                    'svg',\n                                                                    (_React$createElement15 = { width: '13', height: '8', viewBox: '0 0 13 8', fill: 'none', xmlns: 'http://www.w3.org/2000/svg', 'data-qa-file': 'ChatPage',\n                                                                        __source: {\n                                                                            fileName: _jsxFileName,\n                                                                            lineNumber: 306\n                                                                        },\n                                                                        __self: _this2\n                                                                    }, (0, _defineProperty3.default)(_React$createElement15, '__self', _this2), (0, _defineProperty3.default)(_React$createElement15, 'data-qa-file', 'ChatPage'), (0, _defineProperty3.default)(_React$createElement15, 'data-qa-file', 'ChatPage'), _React$createElement15),\n                                                                    _react2.default.createElement('path', (_React$createElement14 = { fillRule: 'evenodd', clipRule: 'evenodd', d: 'M6.97016 0.969982C7.11011 0.831254 7.29903 0.753178 7.49609 0.752634C7.69315 0.752091 7.8825 0.829123 8.02321 0.967077C8.16392 1.10503 8.24469 1.29282 8.24805 1.48985C8.25141 1.68688 8.17709 1.87731 8.04116 2.01998L4.04916 7.00998C3.98055 7.08388 3.89774 7.14318 3.80569 7.18435C3.71364 7.22551 3.61423 7.24769 3.51341 7.24956C3.41259 7.25143 3.31243 7.23294 3.21891 7.19521C3.1254 7.15749 3.04046 7.10129 2.96916 7.02998L0.324157 4.38398C0.250471 4.31532 0.191368 4.23252 0.150376 4.14052C0.109384 4.04852 0.0873427 3.94921 0.0855659 3.8485C0.0837892 3.7478 0.102314 3.64777 0.140035 3.55438C0.177756 3.461 0.2339 3.37616 0.305119 3.30494C0.376338 3.23373 0.461172 3.17758 0.55456 3.13986C0.647948 3.10214 0.747977 3.08361 0.84868 3.08539C0.949383 3.08717 1.0487 3.10921 1.1407 3.1502C1.2327 3.19119 1.3155 3.2503 1.38416 3.32398L3.47816 5.41698L6.95016 0.991982C6.95639 0.984262 6.96306 0.976915 6.97016 0.969982ZM6.05016 6.10998L6.97016 7.02998C7.04144 7.10113 7.12632 7.1572 7.21974 7.19484C7.31316 7.23247 7.4132 7.25091 7.5139 7.24904C7.6146 7.24717 7.71389 7.22504 7.80585 7.18397C7.89781 7.1429 7.98056 7.08373 8.04916 7.00998L12.0412 2.01998C12.1129 1.94918 12.1696 1.86466 12.2079 1.77146C12.2462 1.67826 12.2654 1.57829 12.2642 1.47752C12.263 1.37676 12.2415 1.27726 12.2011 1.18498C12.1606 1.0927 12.1019 1.00952 12.0286 0.940411C11.9552 0.871304 11.8687 0.817686 11.7742 0.782758C11.6797 0.74783 11.5791 0.73231 11.4784 0.737123C11.3778 0.741937 11.2791 0.766986 11.1883 0.810774C11.0976 0.854562 11.0166 0.916192 10.9502 0.991982L7.47716 5.41698L6.99216 4.93098L6.04916 6.10998H6.05016Z', fill: '#00C7C7', 'data-qa-file': 'ChatPage',\n                                                                        __source: {\n                                                                            fileName: _jsxFileName,\n                                                                            lineNumber: 308\n                                                                        },\n                                                                        __self: _this2\n                                                                    }, (0, _defineProperty3.default)(_React$createElement14, '__self', _this2), (0, _defineProperty3.default)(_React$createElement14, 'data-qa-file', 'ChatPage'), (0, _defineProperty3.default)(_React$createElement14, 'data-qa-file', 'ChatPage'), _React$createElement14))\n                                                                )\n                                                            ),\n                                                            (0, _format2.default)(message.createdAt, 'HH:mm')\n                                                        )\n                                                    ),\n                                                    _react2.default.createElement(\n                                                        'div',\n                                                        (_React$createElement19 = { className: _ChatPage2.default.messageText, 'data-qa-file': 'ChatPage',\n                                                            __source: {\n                                                                fileName: _jsxFileName,\n                                                                lineNumber: 315\n                                                            },\n                                                            __self: _this2\n                                                        }, (0, _defineProperty3.default)(_React$createElement19, '__self', _this2), (0, _defineProperty3.default)(_React$createElement19, 'data-qa-file', 'ChatPage'), (0, _defineProperty3.default)(_React$createElement19, 'data-qa-file', 'ChatPage'), _React$createElement19),\n                                                        message.text\n                                                    )\n                                                )\n                                            );\n                                        })\n                                    );\n                                }\n                            })\n                        ),\n                        _react2.default.createElement(\n                            'div',\n                            (_React$createElement28 = { className: _ChatPage2.default.messageInput, 'data-qa-file': 'ChatPage',\n                                __source: {\n                                    fileName: _jsxFileName,\n                                    lineNumber: 323\n                                },\n                                __self: this\n                            }, (0, _defineProperty3.default)(_React$createElement28, '__self', this), (0, _defineProperty3.default)(_React$createElement28, 'data-qa-file', 'ChatPage'), (0, _defineProperty3.default)(_React$createElement28, 'data-qa-file', 'ChatPage'), _React$createElement28),\n                            _react2.default.createElement(\n                                'div',\n                                (_React$createElement25 = { className: _ChatPage2.default.inputWrapper, 'data-qa-file': 'ChatPage',\n                                    __source: {\n                                        fileName: _jsxFileName,\n                                        lineNumber: 324\n                                    },\n                                    __self: this\n                                }, (0, _defineProperty3.default)(_React$createElement25, '__self', this), (0, _defineProperty3.default)(_React$createElement25, 'data-qa-file', 'ChatPage'), (0, _defineProperty3.default)(_React$createElement25, 'data-qa-file', 'ChatPage'), _React$createElement25),\n                                _react2.default.createElement('input', (_React$createElement24 = { className: _ChatPage2.default.input, value: value, onChange: this.handleChange, type: 'text', 'data-qa-file': 'ChatPage',\n                                    __source: {\n                                        fileName: _jsxFileName,\n                                        lineNumber: 325\n                                    },\n                                    __self: this\n                                }, (0, _defineProperty3.default)(_React$createElement24, '__self', this), (0, _defineProperty3.default)(_React$createElement24, 'data-qa-file', 'ChatPage'), (0, _defineProperty3.default)(_React$createElement24, 'data-qa-file', 'ChatPage'), _React$createElement24))\n                            ),\n                            value ? _react2.default.createElement(\n                                'button',\n                                (_React$createElement26 = { className: _ChatPage2.default.button, type: 'submit', 'data-qa-file': 'ChatPage',\n                                    __source: {\n                                        fileName: _jsxFileName,\n                                        lineNumber: 327\n                                    },\n                                    __self: this\n                                }, (0, _defineProperty3.default)(_React$createElement26, '__self', this), (0, _defineProperty3.default)(_React$createElement26, 'data-qa-file', 'ChatPage'), (0, _defineProperty3.default)(_React$createElement26, 'data-qa-file', 'ChatPage'), _React$createElement26),\n                                '\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u0438\\u0442\\u044C'\n                            ) : _react2.default.createElement(\n                                'button',\n                                (_React$createElement27 = { className: _ChatPage2.default.buttonDisabled, type: 'button', 'data-qa-file': 'ChatPage',\n                                    __source: {\n                                        fileName: _jsxFileName,\n                                        lineNumber: 328\n                                    },\n                                    __self: this\n                                }, (0, _defineProperty3.default)(_React$createElement27, '__self', this), (0, _defineProperty3.default)(_React$createElement27, 'data-qa-file', 'ChatPage'), (0, _defineProperty3.default)(_React$createElement27, 'data-qa-file', 'ChatPage'), _React$createElement27),\n                                '\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u0438\\u0442\\u044C'\n                            )\n                        )\n                    )\n                )\n            );\n        }\n    }]);\n    return MainPage;\n}(_react.Component);\n\nexports.default = (0, _reactRedux.connect)(undefined, mapDispatchToProps)(MainPage);",{"version":3,"sources":["src\\apps\\admin\\ui\\pages\\ChatPage\\ChatPage.jsx"],"names":["mapDispatchToProps","dispatch","getMessageHistory","payload","getUsers","editMessage","getUnvisitedMessageHistory","MainPage","props","propTypes","PropTypes","func","isRequired","filterChatsBySearch","chats","search","state","filter","user","usersMap","messagesByUser","userId","name","surname","toLowerCase","indexOf","handleSearchChange","newValue","event","target","value","setState","showedMessagesByUsers","messagesByUsers","scrollToBottomNewMessage","messagesWrapper","current","classList","remove","styles","noScrollWrapper","scrollHeight","clientHeight","add","scrollTop","getData","Promise","all","then","messages","users","allUsers","reduce","result","id","newMessagesByUsers","currentUserMessages","item","senderId","receiverId","sortedByDateMessages","acc","length","currentItemDate","createdAt","currentArrayDate","push","unvisitedMessages","visited","unvisitedMessagesCounter","sort","prev","next","activeTabId","scrollToBottom","handleMessage","message","index","unshift","splice","handleSubmit","preventDefault","messageWebsocketController","sendMessage","text","handleTabClick","messagesByUsersIndex","showedMessagesByUsersIndex","getDateHelper","milliseconds","handleChange","React","createRef","events","on","prevProps","prevState","removeListener","content","position","messengerContainer","undefined","contacts","map","i","lastMessage","contact","active","info","userFullName","messageYou","date","rate","find","messagesContainer","isMyMessage","messageContent","messageContentTop","messageName","messageType","messageDate","receivedIcon","messageText","messageInput","inputWrapper","input","button","buttonDisabled","Component"],"mappings":"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","file":"ChatPage.jsx","sourceRoot":"C:\\Users\\cherv\\OneDrive\\Рабочий стол\\deltaway.20","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\n\nimport last from '@tinkoff/utils/array/last';\nimport findIndex from '@tinkoff/utils/array/findIndex';\n\nimport TextField from '@material-ui/core/TextField/TextField';\n\nimport { connect } from 'react-redux';\n\nimport styles from './ChatPage.css';\n\nimport classNames from 'classnames';\n\nimport format from 'date-fns/format';\nimport isToday from 'date-fns/isToday';\nimport isThisWeek from 'date-fns/isThisWeek';\n\nimport messageWebsocketController from '../../../services/messageWebsocket';\nimport getMessageHistory from '../../../services/getMessageHistory';\nimport getUsers from '../../../services/getUsers';\nimport editMessage from '../../../services/editMessage';\nimport getUnvisitedMessageHistory from '../../../services/getUnvisitedMessageHistory';\n\nconst mapDispatchToProps = (dispatch) => ({\n    getMessageHistory: payload => dispatch(getMessageHistory(payload)),\n    getUsers: payload => dispatch(getUsers(payload)),\n    editMessage: payload => dispatch(editMessage(payload)),\n    getUnvisitedMessageHistory: payload => dispatch(getUnvisitedMessageHistory(payload))\n});\n\nclass MainPage extends Component {\n    propTypes = {\n        getMessageHistory: PropTypes.func.isRequired,\n        getUsers: PropTypes.func.isRequired,\n        editMessage: PropTypes.func.isRequired,\n        getUnvisitedMessageHistory: PropTypes.func.isRequired\n    };\n\n    constructor (props) {\n        super(props);\n\n        this.state = {\n            value: '',\n            search: '',\n            messagesByUsers: [],\n            showedMessagesByUsers: [],\n            users: [],\n            activeTabId: null\n        };\n\n        this.messagesWrapper = React.createRef();\n    }\n\n    componentDidMount () {\n        messageWebsocketController.events.on('message', this.handleMessage);\n\n        this.getData();\n    }\n\n    componentDidUpdate (prevProps, prevState) {\n        if (prevState.activeTabId !== this.state.activeTabId) {\n            this.scrollToBottom();\n        }\n    }\n\n    filterChatsBySearch = (chats, search = this.state.search) => {\n        return chats.filter(messagesByUser => {\n            const user = this.state.usersMap[messagesByUser.userId];\n            const name = user && `${user.name} ${user.surname}`.toLowerCase();\n\n            return !search || name && name.indexOf(search.toLowerCase()) !== -1;\n        });\n    };\n\n    handleSearchChange = event => {\n        const newValue = event.target.value;\n\n        this.setState({\n            search: newValue,\n            showedMessagesByUsers: this.filterChatsBySearch(this.state.messagesByUsers, newValue)\n        });\n    };\n\n    scrollToBottomNewMessage = () => {\n        this.messagesWrapper.current.classList.remove(styles.noScrollWrapper);\n        if (this.messagesWrapper.current.scrollHeight <= this.messagesWrapper.current.clientHeight) {\n            this.messagesWrapper.current.classList.add(styles.noScrollWrapper);\n        } else {\n            this.messagesWrapper.current.scrollTop = this.messagesWrapper.current.scrollHeight;\n        }\n    };\n\n    scrollToBottom () {\n        this.messagesWrapper.current.scrollTop = this.messagesWrapper.current.scrollHeight;\n    }\n\n    componentWillUnmount () {\n        messageWebsocketController.events.removeListener('message', this.handleMessage);\n    }\n\n    getData = () => {\n        Promise.all([\n            this.props.getMessageHistory(),\n            this.props.getUsers()\n        ])\n            .then(([messages, users]) => {\n                const allUsers = users.payload;\n\n                this.setState({\n                    users: allUsers,\n                    usersMap: allUsers.reduce((result, user) => ({\n                        ...result,\n                        [user.id]: user\n                    }), {})\n                });\n\n                const newMessagesByUsers = allUsers\n                    .reduce((result, user) => {\n                        const currentUserMessages = messages.filter((item) => { return user.id === item.senderId || user.id === item.receiverId; });\n                        const sortedByDateMessages = currentUserMessages.reduce((acc, item) => {\n                            if (acc[acc.length - 1][0]) {\n                                let currentItemDate = format(item.createdAt, 'P');\n                                let currentArrayDate = format(acc[acc.length - 1][0].createdAt, 'P');\n\n                                if (currentArrayDate === currentItemDate) {\n                                    acc[acc.length - 1].push(item);\n                                } else acc.push([item]);\n                            } else acc[acc.length - 1].push(item);\n\n                            return acc;\n                        }, [[]]);\n                        const unvisitedMessages = currentUserMessages.filter((item) => {\n                            return item.receiverId === 'admin' && !item.visited;\n                        });\n\n                        return [\n                            ...result,\n                            {\n                                userId: user.id,\n                                messages: sortedByDateMessages,\n                                unvisitedMessagesCounter: unvisitedMessages.length\n                            }\n                        ];\n                    }, [])\n                    .sort((prev, next) => {\n                        if (!prev.messages[0].length) {\n                            return 1;\n                        }\n                        if (!next.messages[0].length) {\n                            return 1;\n                        }\n                        return last(prev.messages[0]).createdAt - last(next.messages[0]).createdAt < 0 ? 1 : -1;\n                    });\n\n                this.setState({\n                    activeTabId: newMessagesByUsers[0].userId,\n                    messagesByUsers: newMessagesByUsers,\n                    showedMessagesByUsers: newMessagesByUsers\n                });\n                this.scrollToBottom();\n            });\n    };\n\n    handleMessage = message => {\n        const { messagesByUsers } = this.state;\n        const userId = message.senderId === 'admin' ? message.receiverId : message.senderId;\n\n        const index = findIndex(messagesByUser => messagesByUser.userId === userId, messagesByUsers);\n\n        if (index === -1) {\n            messagesByUsers.unshift({ userId, messages: [message] });\n        } else {\n            messagesByUsers[index].messages[messagesByUsers[index].messages.length - 1].push(message);\n            if (last(last(messagesByUsers[index].messages)).receiverId === 'admin') {\n                messagesByUsers[index].unvisitedMessagesCounter = messagesByUsers[index].unvisitedMessagesCounter + 1;\n            }\n            const messagesByUser = messagesByUsers[index];\n\n            messagesByUsers.splice(index, 1);\n            messagesByUsers.unshift(messagesByUser);\n        }\n\n        this.setState({\n            messagesByUsers,\n            showedMessagesByUsers: this.filterChatsBySearch(messagesByUsers)\n        }, () => this.scrollToBottomNewMessage());\n    };\n\n    handleSubmit = receiverId => event => {\n        event.preventDefault();\n        const { value } = this.state;\n\n        messageWebsocketController.sendMessage({\n            text: value,\n            receiverId\n        });\n\n        this.setState({\n            value: '',\n            activeTabId: receiverId\n        });\n        this.scrollToBottom();\n    };\n\n    handleTabClick = (index, userId) => () => {\n        const { messagesByUsers, showedMessagesByUsers } = this.state;\n        const messagesByUsersIndex = findIndex(messagesByUser => messagesByUser.userId === userId, messagesByUsers);\n        messagesByUsers[messagesByUsersIndex] = { ...messagesByUsers[messagesByUsersIndex], unvisitedMessagesCounter: 0 };\n        const showedMessagesByUsersIndex = findIndex(messagesByUser => messagesByUser.userId === userId, showedMessagesByUsers);\n        showedMessagesByUsers[showedMessagesByUsersIndex] = { ...showedMessagesByUsers[showedMessagesByUsersIndex], unvisitedMessagesCounter: 0 };\n\n        this.setState({ activeTabId: userId, messagesByUsers, showedMessagesByUsers });\n        this.props.editMessage({ id: userId })\n            .then(this.props.getUnvisitedMessageHistory);\n    };\n\n    getDateHelper = (milliseconds) => {\n        return `${format(milliseconds, 'd')} ${format(milliseconds, 'MMMM')}`;\n    }\n\n    handleChange = event => {\n        this.setState({\n            value: event.target.value\n        });\n    };\n\n    render () {\n        const { value, messagesByUsers, showedMessagesByUsers, activeTabId, usersMap, search } = this.state;\n\n        return <div className={styles.content} style={{ position: 'relative' }}>\n            <div>\n                <TextField\n                    label='Поиск по имени клиента'\n                    fullWidth\n                    value={search}\n                    onChange={this.handleSearchChange}\n                    margin='normal'\n                    variant='outlined'\n                    type='text'\n                />\n            </div>\n            <form className={styles.messengerContainer} onSubmit={messagesByUsers.length ? this.handleSubmit(activeTabId) : undefined}>\n                <div className={styles.contacts}>\n                    {showedMessagesByUsers.map((messagesByUser, i) => {\n                        const user = usersMap[messagesByUser.userId];\n                        const lastMessage = messagesByUser.messages ? last(messagesByUser.messages[messagesByUser.messages.length - 1]) : undefined;\n\n                        return <div className={classNames(styles.contact, { [styles.active]: activeTabId === messagesByUser.userId })}\n                            key={i} onClick={this.handleTabClick(i, user.id)}>\n                            <div className={styles.info}>\n                                <h1 className={styles.userFullName}>{user.name} {user.surname}</h1>\n                                <div className={styles.lastMessage}>\n                                    {\n                                        lastMessage && lastMessage.senderId === 'admin' &&\n                                        <div className={styles.messageYou}>Вы:</div>\n                                    }\n                                    {lastMessage && <div className={styles.text}>{lastMessage.text}</div>}\n                                    {lastMessage &&\n                                        <div className={styles.date}>\n                                            {isToday(lastMessage.createdAt)\n                                                ? format(lastMessage.createdAt, 'HH:mm')\n                                                : isThisWeek(lastMessage.createdAt)\n                                                    ? format(lastMessage.createdAt, 'EEEE')\n                                                    : format(lastMessage.createdAt, 'P')\n                                            }\n                                        </div>\n                                    }\n                                </div>\n                            </div>\n                            {messagesByUser.unvisitedMessagesCounter\n                                ? <span className={styles.rate}>\n                                    {messagesByUser.unvisitedMessagesCounter}\n                                </span>\n                                : undefined}\n                        </div>;\n                    })}\n                </div>\n                <div className={styles.messages}>\n                    <div ref={this.messagesWrapper} className={styles.messagesWrapper}>\n                        {(messagesByUsers.find(messagesByUser => messagesByUser.userId === activeTabId) || { messages: [] }).messages.map((item, i) => {\n                            if (item.length) {\n                                return <div className={styles.messagesContainer} data-attr={this.getDateHelper(item[0].createdAt)}>\n                                    {item.map((message, i) => {\n                                        const isMyMessage = message.senderId === 'admin';\n                                        const user = usersMap[message.senderId];\n\n                                        return <div key={i} className={classNames(styles.message, { [styles.messageYou]: isMyMessage })}>\n                                            <div className={styles.messageContent}>\n                                                <div className={styles.messageContentTop}>\n                                                    <div className={styles.messageName}>\n                                                        {!isMyMessage ? `${user.name} ${user.surname}` : 'Админ'}\n                                                    </div>\n                                                    {\n                                                        // please check, there is no type in messagesByUser.messages\n                                                        !isMyMessage && <div className={styles.messageType}>\n                                                            {/* {text[messagesByUsers[activeTab].userId.type]} */}\n                                                        </div>\n                                                        //\n                                                    }\n                                                    <div className={styles.messageDate}>\n                                                        {\n                                                            isMyMessage &&\n                                                            <span className={styles.receivedIcon}>\n\n                                                                <svg width=\"13\" height=\"8\" viewBox=\"0 0 13 8\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                                                                    {/* eslint-disable-next-line max-len */}\n                                                                    <path fillRule=\"evenodd\" clipRule=\"evenodd\" d=\"M6.97016 0.969982C7.11011 0.831254 7.29903 0.753178 7.49609 0.752634C7.69315 0.752091 7.8825 0.829123 8.02321 0.967077C8.16392 1.10503 8.24469 1.29282 8.24805 1.48985C8.25141 1.68688 8.17709 1.87731 8.04116 2.01998L4.04916 7.00998C3.98055 7.08388 3.89774 7.14318 3.80569 7.18435C3.71364 7.22551 3.61423 7.24769 3.51341 7.24956C3.41259 7.25143 3.31243 7.23294 3.21891 7.19521C3.1254 7.15749 3.04046 7.10129 2.96916 7.02998L0.324157 4.38398C0.250471 4.31532 0.191368 4.23252 0.150376 4.14052C0.109384 4.04852 0.0873427 3.94921 0.0855659 3.8485C0.0837892 3.7478 0.102314 3.64777 0.140035 3.55438C0.177756 3.461 0.2339 3.37616 0.305119 3.30494C0.376338 3.23373 0.461172 3.17758 0.55456 3.13986C0.647948 3.10214 0.747977 3.08361 0.84868 3.08539C0.949383 3.08717 1.0487 3.10921 1.1407 3.1502C1.2327 3.19119 1.3155 3.2503 1.38416 3.32398L3.47816 5.41698L6.95016 0.991982C6.95639 0.984262 6.96306 0.976915 6.97016 0.969982ZM6.05016 6.10998L6.97016 7.02998C7.04144 7.10113 7.12632 7.1572 7.21974 7.19484C7.31316 7.23247 7.4132 7.25091 7.5139 7.24904C7.6146 7.24717 7.71389 7.22504 7.80585 7.18397C7.89781 7.1429 7.98056 7.08373 8.04916 7.00998L12.0412 2.01998C12.1129 1.94918 12.1696 1.86466 12.2079 1.77146C12.2462 1.67826 12.2654 1.57829 12.2642 1.47752C12.263 1.37676 12.2415 1.27726 12.2011 1.18498C12.1606 1.0927 12.1019 1.00952 12.0286 0.940411C11.9552 0.871304 11.8687 0.817686 11.7742 0.782758C11.6797 0.74783 11.5791 0.73231 11.4784 0.737123C11.3778 0.741937 11.2791 0.766986 11.1883 0.810774C11.0976 0.854562 11.0166 0.916192 10.9502 0.991982L7.47716 5.41698L6.99216 4.93098L6.04916 6.10998H6.05016Z\" fill=\"#00C7C7\" />\n                                                                </svg>\n                                                            </span>\n                                                        }\n                                                        {format(message.createdAt, 'HH:mm')}\n                                                    </div>\n                                                </div>\n                                                <div className={styles.messageText}>{message.text}</div>\n                                            </div>\n                                        </div>;\n                                    })}\n                                </div>;\n                            }\n                        })}\n                    </div>\n                    <div className={styles.messageInput}>\n                        <div className={styles.inputWrapper}>\n                            <input className={styles.input} value={value} onChange={this.handleChange} type=\"text\" />\n                        </div>\n                        {value ? <button className={styles.button} type='submit' >Отправить</button>\n                            : <button className={styles.buttonDisabled} type='button' >Отправить</button>}\n                    </div>\n                </div>\n            </form >\n        </div >;\n    }\n}\n\nexport default connect(undefined, mapDispatchToProps)(MainPage);\n"]}]}