{"remainingRequest":"/Users/dimasabitov/Downloads/deltaway.20/node_modules/babel-loader/lib/index.js??ref--13-2!/Users/dimasabitov/Downloads/deltaway.20/src/apps/admin/ui/components/UserForm/UserForm.jsx","dependencies":[{"path":"/Users/dimasabitov/Downloads/deltaway.20/src/apps/admin/ui/components/UserForm/UserForm.jsx","mtime":1671546440325},{"path":"/Users/dimasabitov/Downloads/deltaway.20/.babelrc","mtime":1671546158632},{"path":"/Users/dimasabitov/Downloads/deltaway.20/node_modules/cache-loader/dist/cjs.js","mtime":1671546959174},{"path":"/Users/dimasabitov/Downloads/deltaway.20/node_modules/babel-loader/lib/index.js","mtime":1671546957682}],"contextDependencies":[],"result":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _defineProperty2 = require('babel-runtime/helpers/defineProperty');\n\nvar _defineProperty3 = _interopRequireDefault(_defineProperty2);\n\nvar _extends2 = require('babel-runtime/helpers/extends');\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _class,\n    _temp,\n    _jsxFileName = '/Users/dimasabitov/Downloads/deltaway.20/src/apps/admin/ui/components/UserForm/UserForm.jsx';\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _propTypes = require('prop-types');\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _reactRedux = require('react-redux');\n\nvar _classnames = require('classnames');\n\nvar _classnames2 = _interopRequireDefault(_classnames);\n\nvar _noop = require('@tinkoff/utils/function/noop');\n\nvar _noop2 = _interopRequireDefault(_noop);\n\nvar _prop = require('@tinkoff/utils/object/prop');\n\nvar _prop2 = _interopRequireDefault(_prop);\n\nvar _empty = require('@tinkoff/utils/is/empty');\n\nvar _empty2 = _interopRequireDefault(_empty);\n\nvar _includes = require('@tinkoff/utils/array/includes');\n\nvar _includes2 = _interopRequireDefault(_includes);\n\nvar _Snackbar = require('@material-ui/core/Snackbar');\n\nvar _Snackbar2 = _interopRequireDefault(_Snackbar);\n\nvar _SnackbarContent = require('@material-ui/core/SnackbarContent');\n\nvar _SnackbarContent2 = _interopRequireDefault(_SnackbarContent);\n\nvar _Error = require('@material-ui/icons/Error');\n\nvar _Error2 = _interopRequireDefault(_Error);\n\nvar _styles = require('@material-ui/core/styles');\n\nvar _Form = require('../Form/Form');\n\nvar _Form2 = _interopRequireDefault(_Form);\n\nvar _userFormSchema = require('./userFormSchema');\n\nvar _userFormSchema2 = _interopRequireDefault(_userFormSchema);\n\nvar _editUser2 = require('../../../services/editUser');\n\nvar _editUser3 = _interopRequireDefault(_editUser2);\n\nvar _uniqid = require('uniqid');\n\nvar _uniqid2 = _interopRequireDefault(_uniqid);\n\nvar _getStatus = require('../../../../../../server/helpers/getStatus');\n\nvar _getStatus2 = _interopRequireDefault(_getStatus);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n    return {\n        editUser: function editUser(payload) {\n            return dispatch((0, _editUser3.default)(payload));\n        }\n    };\n};\n\nvar materialStyles = function materialStyles(theme) {\n    return {\n        error: {\n            backgroundColor: theme.palette.error.dark\n        },\n        icon: {\n            fontSize: 20\n        },\n        iconVariant: {\n            opacity: 0.9,\n            marginRight: theme.spacing.unit\n        },\n        message: {\n            display: 'flex',\n            alignItems: 'center'\n        },\n        margin: {\n            margin: theme.spacing.unit\n        }\n    };\n};\n\nvar UserForm = (_temp = _class = function (_Component) {\n    (0, _inherits3.default)(UserForm, _Component);\n\n    function UserForm() {\n        var _ref;\n\n        (0, _classCallCheck3.default)(this, UserForm);\n\n        for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n            args[_key] = arguments[_key];\n        }\n\n        var _this = (0, _possibleConstructorReturn3.default)(this, (_ref = UserForm.__proto__ || Object.getPrototypeOf(UserForm)).call.apply(_ref, [this].concat(args)));\n\n        _this.formatPhone = function (phone, country) {\n            if (country === 'ua' && (0, _includes2.default)('(+380)', phone)) {\n                return phone.substring(6);\n            } else if (country === 'ru' && (0, _includes2.default)('(+7)', phone)) {\n                return phone.substring(4);\n            } else if (country === 'by' && (0, _includes2.default)('(+375)', phone)) {\n                return phone.substring(6);\n            } else {\n                return phone;\n            }\n        };\n\n        _this.getUserPayload = function (_ref2) {\n            var name = _ref2.name,\n                surname = _ref2.surname,\n                accountNumber = _ref2.accountNumber,\n                balance = _ref2.balance,\n                email = _ref2.email,\n                phone = _ref2.phone,\n                accountStatus = _ref2.accountStatus,\n                country = _ref2.country,\n                city = _ref2.city,\n                address = _ref2.address,\n                blocked = _ref2.blocked,\n                password = _ref2.password,\n                identity = _ref2.identity,\n                residence = _ref2.residence,\n                cardFront = _ref2.cardFront,\n                cardBack = _ref2.cardBack,\n                others = _ref2.others,\n                isActive = _ref2.isActive,\n                isVipStatus = _ref2.isVipStatus;\n\n            return (0, _extends3.default)({\n                name: name,\n                surname: surname,\n                accountNumber: accountNumber,\n                balance: +balance,\n                email: email,\n                phone: phone,\n                country: country,\n                city: city,\n                address: address,\n                dirName: _this.dirName,\n                blocked: blocked,\n                accountStatus: accountStatus\n            }, password ? { password: password } : {}, {\n                isActive: isActive,\n                isVipStatus: isVipStatus,\n                docs: (0, _extends3.default)({}, !(0, _empty2.default)(identity) ? {\n                    identity: {\n                        path: identity[0].path,\n                        name: identity[0].name\n                    }\n                } : {}, !(0, _empty2.default)(residence) ? {\n                    residence: {\n                        path: residence[0].path,\n                        name: residence[0].name\n                    }\n                } : {}, !(0, _empty2.default)(cardFront) ? {\n                    cardFront: {\n                        path: cardFront[0].path,\n                        name: cardFront[0].name\n                    }\n                } : {}, !(0, _empty2.default)(cardBack) ? {\n                    cardBack: {\n                        path: cardBack[0].path,\n                        name: cardBack[0].name\n                    }\n                } : {}, {\n                    others: others\n                }),\n                id: _this.id\n            });\n        };\n\n        _this.handleChange = function (values, changes) {\n            switch (Object.keys(changes)[0]) {\n                case 'isVipStatus':\n                    values.accountStatus = !values.isVipStatus && !!(0, _getStatus2.default)(_this.props.user.balance) ? (0, _getStatus2.default)(_this.props.user.balance) : !values.isVipStatus && !(0, _getStatus2.default)(_this.props.user.balance) ? '' : (0, _getStatus2.default)(_this.props.user.balance, changes.isVipStatus);\n                    break;\n            }\n        };\n\n        _this.handleSubmit = function (values) {\n            var userPayload = _this.getUserPayload(values);\n            var _this$props = _this.props,\n                editUser = _this$props.editUser,\n                onDone = _this$props.onDone;\n\n\n            editUser(userPayload).then(function () {\n                onDone();\n            }).catch(function () {\n                _this.setState({\n                    errorText: 'Что-то пошло не так. Перезагрузите страницы и попробуйте снова'\n                });\n            });\n        };\n\n        _this.handleHideFailMessage = function () {\n            _this.setState({\n                errorText: ''\n            });\n        };\n\n        var user = _this.props.user;\n\n        _this.dirName = user.dirName || (0, _uniqid2.default)();\n        _this.initialValues = {\n            name: user.name || '',\n            surname: user.surname || '',\n            accountNumber: user.accountNumber || '',\n            balance: user.balance,\n            email: user.email || '',\n            phone: (user.country === 'ua' ? '(+380)' : user.country === 'ru' ? '(+7)' : '(+375)') + _this.formatPhone(user.phone, user.country) || '',\n            accountStatus: (0, _getStatus2.default)(user.balance, user.isVipStatus) || '',\n            country: user.country || '',\n            city: user.city || '',\n            address: user.address || '',\n            blocked: user.blocked || false,\n            password: '',\n            isActive: user.isActive || 'null',\n            isVipStatus: user.isVipStatus || false,\n            identity: user.docs && user.docs.identity ? [{\n                path: user.docs.identity.path,\n                name: user.docs.identity.name,\n                id: (0, _uniqid2.default)()\n            }] : [],\n            residence: user.docs && user.docs.residence ? [{\n                path: user.docs.residence.path,\n                name: user.docs.residence.name,\n                id: (0, _uniqid2.default)()\n            }] : [],\n            cardFront: user.docs && user.docs.cardFront ? [{\n                path: user.docs.cardFront.path,\n                name: user.docs.cardFront.name,\n                id: (0, _uniqid2.default)()\n            }] : [],\n            cardBack: user.docs && user.docs.cardBack ? [{\n                path: user.docs.cardBack.path,\n                name: user.docs.cardBack.name,\n                id: (0, _uniqid2.default)()\n            }] : [],\n            others: user.docs && user.docs.others && user.docs.others.length !== 0 ? user.docs.others.map(function (item) {\n                return {\n                    type: item.type,\n                    path: item.path,\n                    id: (0, _uniqid2.default)()\n                };\n            }) : []\n        };\n\n        _this.id = (0, _prop2.default)('id', user);\n        _this.state = {\n            errorText: ''\n        };\n        return _this;\n    }\n\n    (0, _createClass3.default)(UserForm, [{\n        key: 'render',\n        value: function render() {\n            var _React$createElement, _React$createElement2, _React$createElement3, _React$createElement4, _React$createElement5, _React$createElement6;\n\n            var classes = this.props.classes;\n            var errorText = this.state.errorText;\n\n\n            return _react2.default.createElement(\n                'div',\n                (_React$createElement6 = {\n                    'data-qa-file': 'UserForm',\n                    __source: {\n                        fileName: _jsxFileName,\n                        lineNumber: 232\n                    },\n                    __self: this\n                }, (0, _defineProperty3.default)(_React$createElement6, '__self', this), (0, _defineProperty3.default)(_React$createElement6, 'data-qa-file', 'UserForm'), (0, _defineProperty3.default)(_React$createElement6, 'data-qa-file', 'UserForm'), _React$createElement6),\n                _react2.default.createElement(_Form2.default, (_React$createElement = {\n                    initialValues: this.initialValues,\n                    schema: (0, _userFormSchema2.default)({\n                        data: {\n                            title: this.id ? 'Редактирование пользователя' : 'Добавление пользователя',\n                            dirName: this.dirName\n                        }\n                    }),\n                    onSubmit: this.handleSubmit,\n                    onChange: this.handleChange,\n                    'data-qa-file': 'UserForm',\n                    __source: {\n                        fileName: _jsxFileName,\n                        lineNumber: 233\n                    },\n                    __self: this\n                }, (0, _defineProperty3.default)(_React$createElement, '__self', this), (0, _defineProperty3.default)(_React$createElement, 'data-qa-file', 'UserForm'), (0, _defineProperty3.default)(_React$createElement, 'data-qa-file', 'UserForm'), _React$createElement)),\n                _react2.default.createElement(\n                    _Snackbar2.default,\n                    (_React$createElement5 = {\n                        anchorOrigin: {\n                            vertical: 'bottom',\n                            horizontal: 'right'\n                        },\n                        onClose: this.handleHideFailMessage,\n                        open: !!errorText,\n                        autoHideDuration: 2000,\n                        'data-qa-file': 'UserForm',\n                        __source: {\n                            fileName: _jsxFileName,\n                            lineNumber: 244\n                        },\n                        __self: this\n                    }, (0, _defineProperty3.default)(_React$createElement5, '__self', this), (0, _defineProperty3.default)(_React$createElement5, 'data-qa-file', 'UserForm'), (0, _defineProperty3.default)(_React$createElement5, 'data-qa-file', 'UserForm'), _React$createElement5),\n                    _react2.default.createElement(_SnackbarContent2.default, (_React$createElement4 = {\n                        className: (0, _classnames2.default)(classes.error, classes.margin),\n                        message: _react2.default.createElement(\n                            'span',\n                            (_React$createElement3 = { id: 'client-snackbar', className: classes.message, 'data-qa-file': 'UserForm',\n                                __source: {\n                                    fileName: _jsxFileName,\n                                    lineNumber: 256\n                                },\n                                __self: this\n                            }, (0, _defineProperty3.default)(_React$createElement3, '__self', this), (0, _defineProperty3.default)(_React$createElement3, 'data-qa-file', 'UserForm'), (0, _defineProperty3.default)(_React$createElement3, 'data-qa-file', 'UserForm'), _React$createElement3),\n                            _react2.default.createElement(_Error2.default, (_React$createElement2 = { className: (0, _classnames2.default)(classes.icon, classes.iconVariant), 'data-qa-file': 'UserForm',\n                                __source: {\n                                    fileName: _jsxFileName,\n                                    lineNumber: 257\n                                },\n                                __self: this\n                            }, (0, _defineProperty3.default)(_React$createElement2, '__self', this), (0, _defineProperty3.default)(_React$createElement2, 'data-qa-file', 'UserForm'), (0, _defineProperty3.default)(_React$createElement2, 'data-qa-file', 'UserForm'), _React$createElement2)),\n                            errorText\n                        ),\n                        'data-qa-file': 'UserForm',\n                        __source: {\n                            fileName: _jsxFileName,\n                            lineNumber: 253\n                        },\n                        __self: this\n                    }, (0, _defineProperty3.default)(_React$createElement4, '__self', this), (0, _defineProperty3.default)(_React$createElement4, 'data-qa-file', 'UserForm'), (0, _defineProperty3.default)(_React$createElement4, 'data-qa-file', 'UserForm'), _React$createElement4))\n                )\n            );\n        }\n    }]);\n    return UserForm;\n}(_react.Component), _class.propTypes = {\n    editUser: _propTypes2.default.func.isRequired,\n    classes: _propTypes2.default.object.isRequired,\n    onDone: _propTypes2.default.func,\n    user: _propTypes2.default.object\n}, _class.defaultProps = {\n    onDone: _noop2.default,\n    user: {}\n}, _temp);\nexports.default = (0, _styles.withStyles)(materialStyles)((0, _reactRedux.connect)(null, mapDispatchToProps)(UserForm));",{"version":3,"sources":["src/apps/admin/ui/components/UserForm/UserForm.jsx"],"names":["mapDispatchToProps","dispatch","editUser","payload","materialStyles","error","backgroundColor","theme","palette","dark","icon","fontSize","iconVariant","opacity","marginRight","spacing","unit","message","display","alignItems","margin","UserForm","args","formatPhone","phone","country","substring","getUserPayload","name","surname","accountNumber","balance","email","accountStatus","city","address","blocked","password","identity","residence","cardFront","cardBack","others","isActive","isVipStatus","dirName","docs","path","id","handleChange","values","changes","Object","keys","props","user","handleSubmit","userPayload","onDone","then","catch","setState","errorText","handleHideFailMessage","initialValues","length","map","type","item","state","classes","data","title","vertical","horizontal","Component","propTypes","PropTypes","func","isRequired","object","defaultProps","noop"],"mappings":"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","file":"UserForm.jsx","sourceRoot":"/Users/dimasabitov/Downloads/deltaway.20","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\n\nimport classNames from 'classnames';\n\nimport noop from '@tinkoff/utils/function/noop';\nimport prop from '@tinkoff/utils/object/prop';\nimport isEmpty from '@tinkoff/utils/is/empty';\nimport includes from '@tinkoff/utils/array/includes';\n\nimport Snackbar from '@material-ui/core/Snackbar';\nimport SnackbarContent from '@material-ui/core/SnackbarContent';\nimport ErrorIcon from '@material-ui/icons/Error';\nimport { withStyles } from '@material-ui/core/styles';\n\nimport Form from '../Form/Form';\nimport getSchema from './userFormSchema';\nimport editUser from '../../../services/editUser';\nimport uniqid from 'uniqid';\nimport getStatus from '../../../../../../server/helpers/getStatus';\n\nconst mapDispatchToProps = (dispatch) => ({\n    editUser: payload => dispatch(editUser(payload))\n});\n\nconst materialStyles = theme => ({\n    error: {\n        backgroundColor: theme.palette.error.dark\n    },\n    icon: {\n        fontSize: 20\n    },\n    iconVariant: {\n        opacity: 0.9,\n        marginRight: theme.spacing.unit\n    },\n    message: {\n        display: 'flex',\n        alignItems: 'center'\n    },\n    margin: {\n        margin: theme.spacing.unit\n    }\n});\n\nclass UserForm extends Component {\n    static propTypes = {\n        editUser: PropTypes.func.isRequired,\n        classes: PropTypes.object.isRequired,\n        onDone: PropTypes.func,\n        user: PropTypes.object\n    };\n\n    static defaultProps = {\n        onDone: noop,\n        user: {}\n    };\n\n    constructor (...args) {\n        super(...args);\n\n        const { user } = this.props;\n        this.dirName = user.dirName || uniqid();\n        this.initialValues = {\n            name: user.name || '',\n            surname: user.surname || '',\n            accountNumber: user.accountNumber || '',\n            balance: user.balance,\n            email: user.email || '',\n            phone: (user.country === 'ua' ? '(+380)' : user.country === 'ru' ? '(+7)' : '(+375)') + this.formatPhone(user.phone, user.country) || '',\n            accountStatus: getStatus(user.balance, user.isVipStatus) || '',\n            country: user.country || '',\n            city: user.city || '',\n            address: user.address || '',\n            blocked: user.blocked || false,\n            password: '',\n            isActive: user.isActive || 'null',\n            isVipStatus: user.isVipStatus || false,\n            identity: (user.docs && user.docs.identity ? [{\n                path: user.docs.identity.path,\n                name: user.docs.identity.name,\n                id: uniqid()\n            }] : []),\n            residence: (user.docs && user.docs.residence ? [{\n                path: user.docs.residence.path,\n                name: user.docs.residence.name,\n                id: uniqid()\n            }] : []),\n            cardFront: (user.docs && user.docs.cardFront ? [{\n                path: user.docs.cardFront.path,\n                name: user.docs.cardFront.name,\n                id: uniqid()\n            }] : []),\n            cardBack: (user.docs && user.docs.cardBack ? [{\n                path: user.docs.cardBack.path,\n                name: user.docs.cardBack.name,\n                id: uniqid()\n            }] : []),\n            others: (user.docs && user.docs.others && user.docs.others.length !== 0 ? user.docs.others.map(item => ({\n                type: item.type,\n                path: item.path,\n                id: uniqid()\n            })) : [])\n        };\n\n        this.id = prop('id', user);\n        this.state = {\n            errorText: ''\n        };\n    }\n\n    formatPhone = (phone, country) => {\n        if (country === 'ua' && includes('(+380)', phone)) {\n            return phone.substring(6);\n        } else if (country === 'ru' && includes('(+7)', phone)) {\n            return phone.substring(4);\n        } else if (country === 'by' && includes('(+375)', phone)) {\n            return phone.substring(6);\n        } else {\n            return phone;\n        }\n    }\n\n    getUserPayload = (\n        {\n            name,\n            surname,\n            accountNumber,\n            balance,\n            email,\n            phone,\n            accountStatus,\n            country,\n            city,\n            address,\n            blocked,\n            password,\n            identity,\n            residence,\n            cardFront,\n            cardBack,\n            others,\n            isActive,\n            isVipStatus\n        }) => {\n        return {\n            name,\n            surname,\n            accountNumber,\n            balance: +balance,\n            email,\n            phone,\n            country,\n            city,\n            address,\n            dirName: this.dirName,\n            blocked,\n            accountStatus,\n            ...(password ? { password } : {}),\n            isActive,\n            isVipStatus,\n            docs: {\n                ...(!isEmpty(identity) ? {\n                    identity: {\n                        path: identity[0].path,\n                        name: identity[0].name\n                    }\n                } : {}),\n                ...(!isEmpty(residence) ? {\n                    residence: {\n                        path: residence[0].path,\n                        name: residence[0].name\n                    }\n                } : {}),\n                ...(!isEmpty(cardFront) ? {\n                    cardFront: {\n                        path: cardFront[0].path,\n                        name: cardFront[0].name\n                    }\n                } : {}),\n                ...(!isEmpty(cardBack) ? {\n                    cardBack: {\n                        path: cardBack[0].path,\n                        name: cardBack[0].name\n                    }\n                } : {}),\n                others\n            },\n            id: this.id\n        };\n    };\n\n    handleChange = (values, changes) => {\n        switch (Object.keys(changes)[0]) {\n        case 'isVipStatus':\n            values.accountStatus =\n                    !values.isVipStatus && !!getStatus(this.props.user.balance)\n                        ? getStatus(this.props.user.balance)\n                        : !values.isVipStatus && !getStatus(this.props.user.balance)\n                            ? ''\n                            : getStatus(this.props.user.balance, changes.isVipStatus);\n            break;\n        }\n    };\n\n    handleSubmit = values => {\n        const userPayload = this.getUserPayload(values);\n        const { editUser, onDone } = this.props;\n\n        editUser(userPayload)\n            .then(() => {\n                onDone();\n            })\n            .catch(() => {\n                this.setState({\n                    errorText: 'Что-то пошло не так. Перезагрузите страницы и попробуйте снова'\n                });\n            });\n    };\n\n    handleHideFailMessage = () => {\n        this.setState({\n            errorText: ''\n        });\n    };\n\n    render () {\n        const { classes } = this.props;\n        const { errorText } = this.state;\n\n        return <div>\n            <Form\n                initialValues={this.initialValues}\n                schema={getSchema({\n                    data: {\n                        title: this.id ? 'Редактирование пользователя' : 'Добавление пользователя',\n                        dirName: this.dirName\n                    }\n                })}\n                onSubmit={this.handleSubmit}\n                onChange={this.handleChange}\n            />\n            <Snackbar\n                anchorOrigin={{\n                    vertical: 'bottom',\n                    horizontal: 'right'\n                }}\n                onClose={this.handleHideFailMessage}\n                open={!!errorText}\n                autoHideDuration={2000}\n            >\n                <SnackbarContent\n                    className={classNames(classes.error, classes.margin)}\n                    message={\n                        <span id='client-snackbar' className={classes.message}>\n                            <ErrorIcon className={classNames(classes.icon, classes.iconVariant)} />\n                            {errorText}\n                        </span>\n                    }\n                />\n            </Snackbar>\n        </div>;\n    }\n}\n\nexport default withStyles(materialStyles)(connect(null, mapDispatchToProps)(UserForm));\n"]}]}