{"remainingRequest":"C:\\Users\\cherv\\OneDrive\\Рабочий стол\\deltaway.20\\node_modules\\babel-loader\\lib\\index.js??ref--13-2!C:\\Users\\cherv\\OneDrive\\Рабочий стол\\deltaway.20\\src\\apps\\admin\\ui\\components\\UserForm\\UserForm.jsx","dependencies":[{"path":"C:\\Users\\cherv\\OneDrive\\Рабочий стол\\deltaway.20\\src\\apps\\admin\\ui\\components\\UserForm\\UserForm.jsx","mtime":1671546440000},{"path":"C:\\Users\\cherv\\OneDrive\\Рабочий стол\\deltaway.20\\.babelrc","mtime":1671546158000},{"path":"C:\\Users\\cherv\\OneDrive\\Рабочий стол\\deltaway.20\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1671546958000},{"path":"C:\\Users\\cherv\\OneDrive\\Рабочий стол\\deltaway.20\\node_modules\\babel-loader\\lib\\index.js","mtime":1671546956000}],"contextDependencies":[],"result":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _defineProperty2 = require('babel-runtime/helpers/defineProperty');\n\nvar _defineProperty3 = _interopRequireDefault(_defineProperty2);\n\nvar _extends2 = require('babel-runtime/helpers/extends');\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _class, _temp;\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _propTypes = require('prop-types');\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _reactRedux = require('react-redux');\n\nvar _classnames = require('classnames');\n\nvar _classnames2 = _interopRequireDefault(_classnames);\n\nvar _noop = require('@tinkoff/utils/function/noop');\n\nvar _noop2 = _interopRequireDefault(_noop);\n\nvar _prop = require('@tinkoff/utils/object/prop');\n\nvar _prop2 = _interopRequireDefault(_prop);\n\nvar _empty = require('@tinkoff/utils/is/empty');\n\nvar _empty2 = _interopRequireDefault(_empty);\n\nvar _includes = require('@tinkoff/utils/array/includes');\n\nvar _includes2 = _interopRequireDefault(_includes);\n\nvar _Snackbar = require('@material-ui/core/Snackbar');\n\nvar _Snackbar2 = _interopRequireDefault(_Snackbar);\n\nvar _SnackbarContent = require('@material-ui/core/SnackbarContent');\n\nvar _SnackbarContent2 = _interopRequireDefault(_SnackbarContent);\n\nvar _Error = require('@material-ui/icons/Error');\n\nvar _Error2 = _interopRequireDefault(_Error);\n\nvar _styles = require('@material-ui/core/styles');\n\nvar _Form = require('../Form/Form');\n\nvar _Form2 = _interopRequireDefault(_Form);\n\nvar _userFormSchema = require('./userFormSchema');\n\nvar _userFormSchema2 = _interopRequireDefault(_userFormSchema);\n\nvar _editUser2 = require('../../../services/editUser');\n\nvar _editUser3 = _interopRequireDefault(_editUser2);\n\nvar _uniqid = require('uniqid');\n\nvar _uniqid2 = _interopRequireDefault(_uniqid);\n\nvar _getStatus = require('../../../../../../server/helpers/getStatus');\n\nvar _getStatus2 = _interopRequireDefault(_getStatus);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n    return {\n        editUser: function editUser(payload) {\n            return dispatch((0, _editUser3.default)(payload));\n        }\n    };\n};\n\nvar materialStyles = function materialStyles(theme) {\n    return {\n        error: {\n            backgroundColor: theme.palette.error.dark\n        },\n        icon: {\n            fontSize: 20\n        },\n        iconVariant: {\n            opacity: 0.9,\n            marginRight: theme.spacing.unit\n        },\n        message: {\n            display: 'flex',\n            alignItems: 'center'\n        },\n        margin: {\n            margin: theme.spacing.unit\n        }\n    };\n};\n\nvar UserForm = (_temp = _class = function (_Component) {\n    (0, _inherits3.default)(UserForm, _Component);\n\n    function UserForm() {\n        var _ref;\n\n        (0, _classCallCheck3.default)(this, UserForm);\n\n        for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n            args[_key] = arguments[_key];\n        }\n\n        var _this = (0, _possibleConstructorReturn3.default)(this, (_ref = UserForm.__proto__ || Object.getPrototypeOf(UserForm)).call.apply(_ref, [this].concat(args)));\n\n        _this.formatPhone = function (phone, country) {\n            if (country === 'ua' && (0, _includes2.default)('(+380)', phone)) {\n                return phone.substring(6);\n            } else if (country === 'ru' && (0, _includes2.default)('(+7)', phone)) {\n                return phone.substring(4);\n            } else if (country === 'by' && (0, _includes2.default)('(+375)', phone)) {\n                return phone.substring(6);\n            } else {\n                return phone;\n            }\n        };\n\n        _this.getUserPayload = function (_ref2) {\n            var name = _ref2.name,\n                surname = _ref2.surname,\n                accountNumber = _ref2.accountNumber,\n                balance = _ref2.balance,\n                email = _ref2.email,\n                phone = _ref2.phone,\n                accountStatus = _ref2.accountStatus,\n                country = _ref2.country,\n                city = _ref2.city,\n                address = _ref2.address,\n                blocked = _ref2.blocked,\n                password = _ref2.password,\n                identity = _ref2.identity,\n                residence = _ref2.residence,\n                cardFront = _ref2.cardFront,\n                cardBack = _ref2.cardBack,\n                others = _ref2.others,\n                isActive = _ref2.isActive,\n                isVipStatus = _ref2.isVipStatus;\n\n            return (0, _extends3.default)({\n                name: name,\n                surname: surname,\n                accountNumber: accountNumber,\n                balance: +balance,\n                email: email,\n                phone: phone,\n                country: country,\n                city: city,\n                address: address,\n                dirName: _this.dirName,\n                blocked: blocked,\n                accountStatus: accountStatus\n            }, password ? { password: password } : {}, {\n                isActive: isActive,\n                isVipStatus: isVipStatus,\n                docs: (0, _extends3.default)({}, !(0, _empty2.default)(identity) ? {\n                    identity: {\n                        path: identity[0].path,\n                        name: identity[0].name\n                    }\n                } : {}, !(0, _empty2.default)(residence) ? {\n                    residence: {\n                        path: residence[0].path,\n                        name: residence[0].name\n                    }\n                } : {}, !(0, _empty2.default)(cardFront) ? {\n                    cardFront: {\n                        path: cardFront[0].path,\n                        name: cardFront[0].name\n                    }\n                } : {}, !(0, _empty2.default)(cardBack) ? {\n                    cardBack: {\n                        path: cardBack[0].path,\n                        name: cardBack[0].name\n                    }\n                } : {}, {\n                    others: others\n                }),\n                id: _this.id\n            });\n        };\n\n        _this.handleChange = function (values, changes) {\n            switch (Object.keys(changes)[0]) {\n                case 'isVipStatus':\n                    values.accountStatus = !values.isVipStatus && !!(0, _getStatus2.default)(_this.props.user.balance) ? (0, _getStatus2.default)(_this.props.user.balance) : !values.isVipStatus && !(0, _getStatus2.default)(_this.props.user.balance) ? '' : (0, _getStatus2.default)(_this.props.user.balance, changes.isVipStatus);\n                    break;\n            }\n        };\n\n        _this.handleSubmit = function (values) {\n            var userPayload = _this.getUserPayload(values);\n            var _this$props = _this.props,\n                editUser = _this$props.editUser,\n                onDone = _this$props.onDone;\n\n\n            editUser(userPayload).then(function () {\n                onDone();\n            }).catch(function () {\n                _this.setState({\n                    errorText: 'Что-то пошло не так. Перезагрузите страницы и попробуйте снова'\n                });\n            });\n        };\n\n        _this.handleHideFailMessage = function () {\n            _this.setState({\n                errorText: ''\n            });\n        };\n\n        var user = _this.props.user;\n\n        _this.dirName = user.dirName || (0, _uniqid2.default)();\n        _this.initialValues = {\n            name: user.name || '',\n            surname: user.surname || '',\n            accountNumber: user.accountNumber || '',\n            balance: user.balance,\n            email: user.email || '',\n            phone: (user.country === 'ua' ? '(+380)' : user.country === 'ru' ? '(+7)' : '(+375)') + _this.formatPhone(user.phone, user.country) || '',\n            accountStatus: (0, _getStatus2.default)(user.balance, user.isVipStatus) || '',\n            country: user.country || '',\n            city: user.city || '',\n            address: user.address || '',\n            blocked: user.blocked || false,\n            password: '',\n            isActive: user.isActive || 'null',\n            isVipStatus: user.isVipStatus || false,\n            identity: user.docs && user.docs.identity ? [{\n                path: user.docs.identity.path,\n                name: user.docs.identity.name,\n                id: (0, _uniqid2.default)()\n            }] : [],\n            residence: user.docs && user.docs.residence ? [{\n                path: user.docs.residence.path,\n                name: user.docs.residence.name,\n                id: (0, _uniqid2.default)()\n            }] : [],\n            cardFront: user.docs && user.docs.cardFront ? [{\n                path: user.docs.cardFront.path,\n                name: user.docs.cardFront.name,\n                id: (0, _uniqid2.default)()\n            }] : [],\n            cardBack: user.docs && user.docs.cardBack ? [{\n                path: user.docs.cardBack.path,\n                name: user.docs.cardBack.name,\n                id: (0, _uniqid2.default)()\n            }] : [],\n            others: user.docs && user.docs.others && user.docs.others.length !== 0 ? user.docs.others.map(function (item) {\n                return {\n                    type: item.type,\n                    path: item.path,\n                    id: (0, _uniqid2.default)()\n                };\n            }) : []\n        };\n\n        _this.id = (0, _prop2.default)('id', user);\n        _this.state = {\n            errorText: ''\n        };\n        return _this;\n    }\n\n    (0, _createClass3.default)(UserForm, [{\n        key: 'render',\n        value: function render() {\n            var _React$createElement, _React$createElement2, _React$createElement3, _React$createElement4, _React$createElement5, _React$createElement6;\n\n            var classes = this.props.classes;\n            var errorText = this.state.errorText;\n\n\n            return _react2.default.createElement(\n                'div',\n                (_React$createElement6 = {\n                    'data-qa-file': 'UserForm'\n                }, (0, _defineProperty3.default)(_React$createElement6, 'data-qa-file', 'UserForm'), (0, _defineProperty3.default)(_React$createElement6, 'data-qa-file', 'UserForm'), _React$createElement6),\n                _react2.default.createElement(_Form2.default, (_React$createElement = {\n                    initialValues: this.initialValues,\n                    schema: (0, _userFormSchema2.default)({\n                        data: {\n                            title: this.id ? 'Редактирование пользователя' : 'Добавление пользователя',\n                            dirName: this.dirName\n                        }\n                    }),\n                    onSubmit: this.handleSubmit,\n                    onChange: this.handleChange,\n                    'data-qa-file': 'UserForm'\n                }, (0, _defineProperty3.default)(_React$createElement, 'data-qa-file', 'UserForm'), (0, _defineProperty3.default)(_React$createElement, 'data-qa-file', 'UserForm'), _React$createElement)),\n                _react2.default.createElement(\n                    _Snackbar2.default,\n                    (_React$createElement5 = {\n                        anchorOrigin: {\n                            vertical: 'bottom',\n                            horizontal: 'right'\n                        },\n                        onClose: this.handleHideFailMessage,\n                        open: !!errorText,\n                        autoHideDuration: 2000,\n                        'data-qa-file': 'UserForm'\n                    }, (0, _defineProperty3.default)(_React$createElement5, 'data-qa-file', 'UserForm'), (0, _defineProperty3.default)(_React$createElement5, 'data-qa-file', 'UserForm'), _React$createElement5),\n                    _react2.default.createElement(_SnackbarContent2.default, (_React$createElement4 = {\n                        className: (0, _classnames2.default)(classes.error, classes.margin),\n                        message: _react2.default.createElement(\n                            'span',\n                            (_React$createElement3 = { id: 'client-snackbar', className: classes.message, 'data-qa-file': 'UserForm'\n                            }, (0, _defineProperty3.default)(_React$createElement3, 'data-qa-file', 'UserForm'), (0, _defineProperty3.default)(_React$createElement3, 'data-qa-file', 'UserForm'), _React$createElement3),\n                            _react2.default.createElement(_Error2.default, (_React$createElement2 = { className: (0, _classnames2.default)(classes.icon, classes.iconVariant), 'data-qa-file': 'UserForm'\n                            }, (0, _defineProperty3.default)(_React$createElement2, 'data-qa-file', 'UserForm'), (0, _defineProperty3.default)(_React$createElement2, 'data-qa-file', 'UserForm'), _React$createElement2)),\n                            errorText\n                        ),\n                        'data-qa-file': 'UserForm'\n                    }, (0, _defineProperty3.default)(_React$createElement4, 'data-qa-file', 'UserForm'), (0, _defineProperty3.default)(_React$createElement4, 'data-qa-file', 'UserForm'), _React$createElement4))\n                )\n            );\n        }\n    }]);\n    return UserForm;\n}(_react.Component), _class.defaultProps = {\n    onDone: _noop2.default,\n    user: {}\n}, _temp);\nexports.default = (0, _styles.withStyles)(materialStyles)((0, _reactRedux.connect)(null, mapDispatchToProps)(UserForm));",null]}