{"remainingRequest":"C:\\Users\\cherv\\OneDrive\\Рабочий стол\\deltaway.20\\node_modules\\babel-loader\\lib\\index.js??ref--13-2!C:\\Users\\cherv\\OneDrive\\Рабочий стол\\deltaway.20\\src\\apps\\admin\\ui\\pages\\TransactionsPage\\TransactionsPage.jsx","dependencies":[{"path":"C:\\Users\\cherv\\OneDrive\\Рабочий стол\\deltaway.20\\src\\apps\\admin\\ui\\pages\\TransactionsPage\\TransactionsPage.jsx","mtime":1671546446000},{"path":"C:\\Users\\cherv\\OneDrive\\Рабочий стол\\deltaway.20\\.babelrc","mtime":1671546158000},{"path":"C:\\Users\\cherv\\OneDrive\\Рабочий стол\\deltaway.20\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1671546958000},{"path":"C:\\Users\\cherv\\OneDrive\\Рабочий стол\\deltaway.20\\node_modules\\babel-loader\\lib\\index.js","mtime":1671546956000}],"contextDependencies":[],"result":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _defineProperty2 = require('babel-runtime/helpers/defineProperty');\n\nvar _defineProperty3 = _interopRequireDefault(_defineProperty2);\n\nvar _extends2 = require('babel-runtime/helpers/extends');\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nvar _toConsumableArray2 = require('babel-runtime/helpers/toConsumableArray');\n\nvar _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);\n\nvar _slicedToArray2 = require('babel-runtime/helpers/slicedToArray');\n\nvar _slicedToArray3 = _interopRequireDefault(_slicedToArray2);\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = require('babel-runtime/helpers/inherits');\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _class,\n    _temp,\n    _jsxFileName = 'C:\\\\Users\\\\cherv\\\\OneDrive\\\\\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B\\\\deltaway.20\\\\src\\\\apps\\\\admin\\\\ui\\\\pages\\\\TransactionsPage\\\\TransactionsPage.jsx';\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _propTypes = require('prop-types');\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _pathOr = require('@tinkoff/utils/object/pathOr');\n\nvar _pathOr2 = _interopRequireDefault(_pathOr);\n\nvar _CircularProgress = require('@material-ui/core/CircularProgress');\n\nvar _CircularProgress2 = _interopRequireDefault(_CircularProgress);\n\nvar _Modal = require('@material-ui/core/Modal');\n\nvar _Modal2 = _interopRequireDefault(_Modal);\n\nvar _Paper = require('@material-ui/core/Paper');\n\nvar _Paper2 = _interopRequireDefault(_Paper);\n\nvar _styles = require('@material-ui/core/styles');\n\nvar _AdminTable = require('../../components/AdminTable/AdminTable.jsx');\n\nvar _AdminTable2 = _interopRequireDefault(_AdminTable);\n\nvar _MoneyOutputForm = require('../../components/MoneyOutputForm/MoneyOutputForm.jsx');\n\nvar _MoneyOutputForm2 = _interopRequireDefault(_MoneyOutputForm);\n\nvar _reactRedux = require('react-redux');\n\nvar _getUsers2 = require('../../../services/getUsers');\n\nvar _getUsers3 = _interopRequireDefault(_getUsers2);\n\nvar _getMoneyOutput2 = require('../../../services/getMoneyOutput');\n\nvar _getMoneyOutput3 = _interopRequireDefault(_getMoneyOutput2);\n\nvar _editMoneyOutput2 = require('../../../services/editMoneyOutput');\n\nvar _editMoneyOutput3 = _interopRequireDefault(_editMoneyOutput2);\n\nvar _deleteOutputsByIds = require('../../../services/deleteOutputsByIds');\n\nvar _deleteOutputsByIds2 = _interopRequireDefault(_deleteOutputsByIds);\n\nvar _outputWebsocket = require('../../../services/outputWebsocket');\n\nvar _outputWebsocket2 = _interopRequireDefault(_outputWebsocket);\n\nvar _getUnvisitedMoneyOutput2 = require('../../../services/getUnvisitedMoneyOutput');\n\nvar _getUnvisitedMoneyOutput3 = _interopRequireDefault(_getUnvisitedMoneyOutput2);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar headerRows = [{ id: 'name', label: 'Имя' }, { id: 'amount', label: 'Сумма' }, { id: 'status', label: 'Статус' }];\n\nvar materialStyles = function materialStyles(theme) {\n    return {\n        loader: {\n            height: 'calc(100vh - 64px)',\n            display: 'flex',\n            justifyContent: 'center',\n            alignItems: 'center'\n        },\n        modal: {\n            display: 'flex',\n            justifyContent: 'center',\n            alignItems: 'center'\n        },\n        modalContent: {\n            position: 'absolute',\n            width: '1200px',\n            backgroundColor: theme.palette.background.paper,\n            boxShadow: theme.shadows[5],\n            padding: theme.spacing.unit * 4,\n            outline: 'none',\n            overflowY: 'auto',\n            maxHeight: '100vh',\n            '@media (max-width:1300px)': {\n                width: '90%'\n            }\n        },\n        warningContent: {\n            paddingBottom: '0'\n        },\n        columnName: {\n            maxWidth: '400px',\n            whiteSpace: 'nowrap',\n            overflow: 'hidden',\n            textOverflow: 'ellipsis',\n            '@media (max-width:1020px)': {\n                maxWidth: '200px'\n            },\n            '@media (max-width:750px)': {\n                maxWidth: '100px'\n            },\n            '@media (max-width:340px)': {\n                maxWidth: '80px'\n            }\n        },\n        columnAlias: {\n            maxWidth: '200px',\n            display: 'block',\n            whiteSpace: 'nowrap',\n            overflow: 'hidden',\n            textOverflow: 'ellipsis',\n            '@media (max-width:850px)': {\n                maxWidth: '100px'\n            },\n            '@media (max-width:400px)': {\n                maxWidth: '50px'\n            }\n        }\n    };\n};\n\nvar mapStateToProps = function mapStateToProps(_ref) {\n    var data = _ref.data;\n\n    return {\n        output: data.output\n    };\n};\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n    return {\n        getUsers: function getUsers(payload) {\n            return dispatch((0, _getUsers3.default)(payload));\n        },\n        getMoneyOutput: function getMoneyOutput(payload) {\n            return dispatch((0, _getMoneyOutput3.default)(payload));\n        },\n        editMoneyOutput: function editMoneyOutput(payload) {\n            return dispatch((0, _editMoneyOutput3.default)(payload));\n        },\n        deleteMoneyOutput: function deleteMoneyOutput(payload) {\n            return dispatch((0, _deleteOutputsByIds2.default)(payload));\n        },\n        getUnvisitedMoneyOutput: function getUnvisitedMoneyOutput(payload) {\n            return dispatch((0, _getUnvisitedMoneyOutput3.default)(payload));\n        }\n    };\n};\n\nvar TransactionsPage = (_temp = _class = function (_Component) {\n    (0, _inherits3.default)(TransactionsPage, _Component);\n\n    function TransactionsPage() {\n        var _ref2,\n            _this2 = this;\n\n        (0, _classCallCheck3.default)(this, TransactionsPage);\n\n        for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n            args[_key] = arguments[_key];\n        }\n\n        var _this = (0, _possibleConstructorReturn3.default)(this, (_ref2 = TransactionsPage.__proto__ || Object.getPrototypeOf(TransactionsPage)).call.apply(_ref2, [this].concat(args)));\n\n        _this.getData = function () {\n            return Promise.all([_this.props.getMoneyOutput(), _this.props.getUsers(false)]).then(function (_ref3) {\n                var _ref4 = (0, _slicedToArray3.default)(_ref3, 2),\n                    outputs = _ref4[0],\n                    users = _ref4[1];\n\n                _this.setState({\n                    loading: false,\n                    outputByUsers: outputs.payload.reduce(function (acc, item) {\n                        var user = users.payload.find(function (user) {\n                            return user.id === item.userId;\n                        });\n\n                        if (user) {\n                            acc.push({\n                                name: user.name,\n                                surname: user.surname,\n                                status: item.status,\n                                date: item.createdAt,\n                                createdAtDate: item.createdAtDate,\n                                amount: item.amount,\n                                id: item.id,\n                                visited: item.visited\n                            });\n                        }\n\n                        return acc;\n                    }, [])\n                });\n            });\n        };\n\n        _this.qwerty = function (output) {\n            _this.props.getUsers(false).then(function (users) {\n                var user = users.payload.find(function (user) {\n                    return user.id === output.userId;\n                });\n\n                _this.setState({\n                    outputByUsers: [].concat((0, _toConsumableArray3.default)(_this.state.outputByUsers), [{\n                        date: output.createdAt,\n                        createdAtDate: output.createdAtDate,\n                        name: user.name,\n                        surname: user.surname,\n                        status: output.status,\n                        amount: output.amount,\n                        id: output.id,\n                        visited: output.visited\n                    }])\n                });\n            });\n        };\n\n        _this.handleFormDone = function () {\n            _this.getData().then(_this.handleCloseUserForm);\n        };\n\n        _this.handleFormOpen = function (user) {\n            return function () {\n                _this.setState({\n                    formShowed: true,\n                    editableUser: user\n                });\n                _this.props.editMoneyOutput((0, _extends3.default)({}, user, { visited: true })).then(_this.getData());\n                _this.props.getUnvisitedMoneyOutput();\n            };\n        };\n\n        _this.handleCloseUserForm = function () {\n            _this.setState({\n                formShowed: false,\n                editableUser: null\n            });\n        };\n\n        _this.handleOutputDelete = function (ids) {\n            return _this.props.deleteMoneyOutput(ids).then(function () {\n                _this.getData();\n                _this.props.getUnvisitedMoneyOutput();\n            });\n        };\n\n        _this.state = {\n            loading: true,\n            formShowed: false,\n            editableUser: null\n        };\n        _this.tableCells = [{ prop: function prop(user) {\n                var _React$createElement;\n\n                return _react2.default.createElement(\n                    'div',\n                    (_React$createElement = { className: _this.props.classes.columnName, 'data-qa-file': 'TransactionsPage',\n                        __source: {\n                            fileName: _jsxFileName,\n                            lineNumber: 119\n                        },\n                        __self: _this2\n                    }, (0, _defineProperty3.default)(_React$createElement, '__self', _this2), (0, _defineProperty3.default)(_React$createElement, 'data-qa-file', 'TransactionsPage'), (0, _defineProperty3.default)(_React$createElement, 'data-qa-file', 'TransactionsPage'), _React$createElement),\n                    (0, _pathOr2.default)(['name'], '', user),\n                    ' ',\n                    (0, _pathOr2.default)(['surname'], '', user)\n                );\n            } }, { prop: function prop(user) {\n                var _React$createElement2;\n\n                return _react2.default.createElement(\n                    'div',\n                    (_React$createElement2 = { className: _this.props.classes.columnName, 'data-qa-file': 'TransactionsPage',\n                        __source: {\n                            fileName: _jsxFileName,\n                            lineNumber: 120\n                        },\n                        __self: _this2\n                    }, (0, _defineProperty3.default)(_React$createElement2, '__self', _this2), (0, _defineProperty3.default)(_React$createElement2, 'data-qa-file', 'TransactionsPage'), (0, _defineProperty3.default)(_React$createElement2, 'data-qa-file', 'TransactionsPage'), _React$createElement2),\n                    (0, _pathOr2.default)(['amount'], '', user)\n                );\n            } }, { prop: function prop(user) {\n                var _React$createElement3;\n\n                return _react2.default.createElement(\n                    'div',\n                    (_React$createElement3 = { className: _this.props.classes.columnName, 'data-qa-file': 'TransactionsPage',\n                        __source: {\n                            fileName: _jsxFileName,\n                            lineNumber: 121\n                        },\n                        __self: _this2\n                    }, (0, _defineProperty3.default)(_React$createElement3, '__self', _this2), (0, _defineProperty3.default)(_React$createElement3, 'data-qa-file', 'TransactionsPage'), (0, _defineProperty3.default)(_React$createElement3, 'data-qa-file', 'TransactionsPage'), _React$createElement3),\n                    (0, _pathOr2.default)(['status'], '', user)\n                );\n            } }];\n        return _this;\n    }\n\n    (0, _createClass3.default)(TransactionsPage, [{\n        key: 'componentDidMount',\n        value: function componentDidMount() {\n            _outputWebsocket2.default.events.on('output', this.qwerty);\n\n            this.getData();\n        }\n    }, {\n        key: 'componentWillUnmount',\n        value: function componentWillUnmount() {\n            _outputWebsocket2.default.events.removeListener('output', this.qwerty);\n        }\n    }, {\n        key: 'render',\n        value: function render() {\n            var _React$createElement6, _React$createElement7, _React$createElement8, _React$createElement9, _React$createElement10;\n\n            var classes = this.props.classes;\n            var _state = this.state,\n                loading = _state.loading,\n                editableUser = _state.editableUser,\n                formShowed = _state.formShowed,\n                outputByUsers = _state.outputByUsers;\n\n\n            if (loading) {\n                var _React$createElement4, _React$createElement5;\n\n                return _react2.default.createElement(\n                    'div',\n                    (_React$createElement5 = { className: classes.loader, 'data-qa-file': 'TransactionsPage',\n                        __source: {\n                            fileName: _jsxFileName,\n                            lineNumber: 220\n                        },\n                        __self: this\n                    }, (0, _defineProperty3.default)(_React$createElement5, '__self', this), (0, _defineProperty3.default)(_React$createElement5, 'data-qa-file', 'TransactionsPage'), (0, _defineProperty3.default)(_React$createElement5, 'data-qa-file', 'TransactionsPage'), _React$createElement5),\n                    _react2.default.createElement(_CircularProgress2.default, (_React$createElement4 = {\n                        'data-qa-file': 'TransactionsPage',\n                        __source: {\n                            fileName: _jsxFileName,\n                            lineNumber: 221\n                        },\n                        __self: this\n                    }, (0, _defineProperty3.default)(_React$createElement4, '__self', this), (0, _defineProperty3.default)(_React$createElement4, 'data-qa-file', 'TransactionsPage'), (0, _defineProperty3.default)(_React$createElement4, 'data-qa-file', 'TransactionsPage'), _React$createElement4))\n                );\n            }\n\n            return _react2.default.createElement(\n                'div',\n                (_React$createElement10 = {\n                    'data-qa-file': 'TransactionsPage',\n                    __source: {\n                        fileName: _jsxFileName,\n                        lineNumber: 225\n                    },\n                    __self: this\n                }, (0, _defineProperty3.default)(_React$createElement10, '__self', this), (0, _defineProperty3.default)(_React$createElement10, 'data-qa-file', 'TransactionsPage'), (0, _defineProperty3.default)(_React$createElement10, 'data-qa-file', 'TransactionsPage'), _React$createElement10),\n                _react2.default.createElement(_AdminTable2.default, (_React$createElement6 = {\n                    headerRows: headerRows,\n                    tableCells: this.tableCells,\n                    values: outputByUsers.sort(function (prev, next) {\n                        return next.createdAtDate - prev.createdAtDate;\n                    }),\n                    headerText: '\\u0417\\u0430\\u043F\\u0440\\u043E\\u0441\\u044B \\u043D\\u0430 \\u0432\\u044B\\u0432\\u043E\\u0434',\n                    deleteValueWarningTitle: '\\u0412\\u044B \\u0442\\u043E\\u0447\\u043D\\u043E \\u0445\\u043E\\u0442\\u0438\\u0442\\u0435 \\u0443\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C \\u0437\\u0430\\u043F\\u0440\\u043E\\u0441?',\n                    deleteValuesWarningTitle: '\\u0412\\u044B \\u0442\\u043E\\u0447\\u043D\\u043E \\u0445\\u043E\\u0442\\u0438\\u0442\\u0435 \\u0443\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C \\u0437\\u0430\\u043F\\u0440\\u043E\\u0441\\u044B?',\n                    onDelete: this.handleOutputDelete,\n                    onFormOpen: this.handleFormOpen,\n                    isAddButton: false,\n                    'data-qa-file': 'TransactionsPage',\n                    __source: {\n                        fileName: _jsxFileName,\n                        lineNumber: 226\n                    },\n                    __self: this\n                }, (0, _defineProperty3.default)(_React$createElement6, '__self', this), (0, _defineProperty3.default)(_React$createElement6, 'data-qa-file', 'TransactionsPage'), (0, _defineProperty3.default)(_React$createElement6, 'data-qa-file', 'TransactionsPage'), _React$createElement6)),\n                _react2.default.createElement(\n                    _Modal2.default,\n                    (_React$createElement9 = { open: formShowed, onClose: this.handleCloseUserForm, className: classes.modal, disableEnforceFocus: true, 'data-qa-file': 'TransactionsPage',\n                        __source: {\n                            fileName: _jsxFileName,\n                            lineNumber: 237\n                        },\n                        __self: this\n                    }, (0, _defineProperty3.default)(_React$createElement9, '__self', this), (0, _defineProperty3.default)(_React$createElement9, 'data-qa-file', 'TransactionsPage'), (0, _defineProperty3.default)(_React$createElement9, 'data-qa-file', 'TransactionsPage'), _React$createElement9),\n                    _react2.default.createElement(\n                        _Paper2.default,\n                        (_React$createElement8 = { className: classes.modalContent, 'data-qa-file': 'TransactionsPage',\n                            __source: {\n                                fileName: _jsxFileName,\n                                lineNumber: 238\n                            },\n                            __self: this\n                        }, (0, _defineProperty3.default)(_React$createElement8, '__self', this), (0, _defineProperty3.default)(_React$createElement8, 'data-qa-file', 'TransactionsPage'), (0, _defineProperty3.default)(_React$createElement8, 'data-qa-file', 'TransactionsPage'), _React$createElement8),\n                        _react2.default.createElement(_MoneyOutputForm2.default, (_React$createElement7 = { user: editableUser, onDone: this.handleFormDone, 'data-qa-file': 'TransactionsPage',\n                            __source: {\n                                fileName: _jsxFileName,\n                                lineNumber: 239\n                            },\n                            __self: this\n                        }, (0, _defineProperty3.default)(_React$createElement7, '__self', this), (0, _defineProperty3.default)(_React$createElement7, 'data-qa-file', 'TransactionsPage'), (0, _defineProperty3.default)(_React$createElement7, 'data-qa-file', 'TransactionsPage'), _React$createElement7))\n                    )\n                )\n            );\n        }\n    }]);\n    return TransactionsPage;\n}(_react.Component), _class.propTypes = {\n    classes: _propTypes2.default.object.isRequired,\n    getUsers: _propTypes2.default.func.isRequired,\n    getMoneyOutput: _propTypes2.default.func.isRequired,\n    editMoneyOutput: _propTypes2.default.func.isRequired,\n    deleteMoneyOutput: _propTypes2.default.func.isRequired,\n    getUnvisitedMoneyOutput: _propTypes2.default.func.isRequired\n}, _temp);\nexports.default = (0, _reactRedux.connect)(mapStateToProps, mapDispatchToProps)((0, _styles.withStyles)(materialStyles)(TransactionsPage));",{"version":3,"sources":["src\\apps\\admin\\ui\\pages\\TransactionsPage\\TransactionsPage.jsx"],"names":["headerRows","id","label","materialStyles","loader","height","display","justifyContent","alignItems","modal","modalContent","position","width","backgroundColor","theme","palette","background","paper","boxShadow","shadows","padding","spacing","unit","outline","overflowY","maxHeight","warningContent","paddingBottom","columnName","maxWidth","whiteSpace","overflow","textOverflow","columnAlias","mapStateToProps","data","output","mapDispatchToProps","dispatch","getUsers","payload","getMoneyOutput","editMoneyOutput","deleteMoneyOutput","getUnvisitedMoneyOutput","TransactionsPage","args","getData","Promise","all","props","then","outputs","users","setState","loading","outputByUsers","reduce","acc","item","user","find","userId","push","name","surname","status","date","createdAt","createdAtDate","amount","visited","qwerty","state","handleFormDone","handleCloseUserForm","handleFormOpen","formShowed","editableUser","handleOutputDelete","ids","tableCells","prop","classes","outputWebsocketController","events","on","removeListener","sort","prev","next","Component","propTypes","PropTypes","object","isRequired","func"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;AAEA;;;;AAEA;;;;AACA;;;;AACA;;;;AACA;;AAEA;;;;AACA;;;;AAEA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,aAAa,CACf,EAAEC,IAAI,MAAN,EAAcC,OAAO,KAArB,EADe,EAEf,EAAED,IAAI,QAAN,EAAgBC,OAAO,OAAvB,EAFe,EAGf,EAAED,IAAI,QAAN,EAAgBC,OAAO,QAAvB,EAHe,CAAnB;;AAMA,IAAMC,iBAAiB,SAAjBA,cAAiB;AAAA,WAAU;AAC7BC,gBAAQ;AACJC,oBAAQ,oBADJ;AAEJC,qBAAS,MAFL;AAGJC,4BAAgB,QAHZ;AAIJC,wBAAY;AAJR,SADqB;AAO7BC,eAAO;AACHH,qBAAS,MADN;AAEHC,4BAAgB,QAFb;AAGHC,wBAAY;AAHT,SAPsB;AAY7BE,sBAAc;AACVC,sBAAU,UADA;AAEVC,mBAAO,QAFG;AAGVC,6BAAiBC,MAAMC,OAAN,CAAcC,UAAd,CAAyBC,KAHhC;AAIVC,uBAAWJ,MAAMK,OAAN,CAAc,CAAd,CAJD;AAKVC,qBAASN,MAAMO,OAAN,CAAcC,IAAd,GAAqB,CALpB;AAMVC,qBAAS,MANC;AAOVC,uBAAW,MAPD;AAQVC,uBAAW,OARD;AASV,yCAA6B;AACzBb,uBAAO;AADkB;AATnB,SAZe;AAyB7Bc,wBAAgB;AACZC,2BAAe;AADH,SAzBa;AA4B7BC,oBAAY;AACRC,sBAAU,OADF;AAERC,wBAAY,QAFJ;AAGRC,sBAAU,QAHF;AAIRC,0BAAc,UAJN;AAKR,yCAA6B;AACzBH,0BAAU;AADe,aALrB;AAQR,wCAA4B;AACxBA,0BAAU;AADc,aARpB;AAWR,wCAA4B;AACxBA,0BAAU;AADc;AAXpB,SA5BiB;AA2C7BI,qBAAa;AACTJ,sBAAU,OADD;AAETvB,qBAAS,OAFA;AAGTwB,wBAAY,QAHH;AAITC,sBAAU,QAJD;AAKTC,0BAAc,UALL;AAMT,wCAA4B;AACxBH,0BAAU;AADc,aANnB;AAST,wCAA4B;AACxBA,0BAAU;AADc;AATnB;AA3CgB,KAAV;AAAA,CAAvB;;AA0DA,IAAMK,kBAAkB,SAAlBA,eAAkB,OAAc;AAAA,QAAXC,IAAW,QAAXA,IAAW;;AAClC,WAAO;AACHC,gBAAQD,KAAKC;AADV,KAAP;AAGH,CAJD;;AAMA,IAAMC,qBAAqB,SAArBA,kBAAqB,CAACC,QAAD;AAAA,WAAe;AACtCC,kBAAU;AAAA,mBAAWD,SAAS,wBAASE,OAAT,CAAT,CAAX;AAAA,SAD4B;AAEtCC,wBAAgB;AAAA,mBAAWH,SAAS,8BAAeE,OAAf,CAAT,CAAX;AAAA,SAFsB;AAGtCE,yBAAiB;AAAA,mBAAWJ,SAAS,+BAAgBE,OAAhB,CAAT,CAAX;AAAA,SAHqB;AAItCG,2BAAmB;AAAA,mBAAWL,SAAS,kCAAkBE,OAAlB,CAAT,CAAX;AAAA,SAJmB;AAKtCI,iCAAyB;AAAA,mBAAWN,SAAS,uCAAwBE,OAAxB,CAAT,CAAX;AAAA;AALa,KAAf;AAAA,CAA3B;;IAQMK,gB;;;AAUF,gCAAsB;AAAA;AAAA;;AAAA;;AAAA,0CAANC,IAAM;AAANA,gBAAM;AAAA;;AAAA,mLACTA,IADS;;AAAA,cAetBC,OAfsB,GAeZ,YAAM;AACZ,mBAAOC,QAAQC,GAAR,CAAY,CACf,MAAKC,KAAL,CAAWT,cAAX,EADe,EAEf,MAAKS,KAAL,CAAWX,QAAX,CAAoB,KAApB,CAFe,CAAZ,EAIFY,IAJE,CAIG,iBAAsB;AAAA;AAAA,oBAApBC,OAAoB;AAAA,oBAAXC,KAAW;;AACxB,sBAAKC,QAAL,CAAc;AACVC,6BAAS,KADC;AAEVC,mCACIJ,QAAQZ,OAAR,CAAgBiB,MAAhB,CAAuB,UAACC,GAAD,EAAMC,IAAN,EAAe;AAClC,4BAAMC,OAAOP,MAAMb,OAAN,CAAcqB,IAAd,CAAmB,UAACD,IAAD,EAAU;AAAE,mCAAOA,KAAK3D,EAAL,KAAY0D,KAAKG,MAAxB;AAAiC,yBAAhE,CAAb;;AAEA,4BAAIF,IAAJ,EAAU;AACNF,gCAAIK,IAAJ,CAAS;AACLC,sCAAMJ,KAAKI,IADN;AAELC,yCAASL,KAAKK,OAFT;AAGLC,wCAAQP,KAAKO,MAHR;AAILC,sCAAMR,KAAKS,SAJN;AAKLC,+CAAeV,KAAKU,aALf;AAMLC,wCAAQX,KAAKW,MANR;AAOLrE,oCAAI0D,KAAK1D,EAPJ;AAQLsE,yCAASZ,KAAKY;AART,6BAAT;AAUH;;AAED,+BAAOb,GAAP;AACH,qBAjBD,EAiBG,EAjBH;AAHM,iBAAd;AAsBH,aA3BE,CAAP;AA4BH,SA5CqB;;AAAA,cAwDtBc,MAxDsB,GAwDb,kBAAU;AACf,kBAAKtB,KAAL,CAAWX,QAAX,CAAoB,KAApB,EACKY,IADL,CACU,UAACE,KAAD,EAAW;AACb,oBAAMO,OAAOP,MAAMb,OAAN,CAAcqB,IAAd,CAAmB,UAACD,IAAD,EAAU;AAAE,2BAAOA,KAAK3D,EAAL,KAAYmC,OAAO0B,MAA1B;AAAmC,iBAAlE,CAAb;;AAEA,sBAAKR,QAAL,CAAc;AACVE,8EAAmB,MAAKiB,KAAL,CAAWjB,aAA9B,IAA6C;AACzCW,8BAAM/B,OAAOgC,SAD4B;AAEzCC,uCAAejC,OAAOiC,aAFmB;AAGzCL,8BAAMJ,KAAKI,IAH8B;AAIzCC,iCAASL,KAAKK,OAJ2B;AAKzCC,gCAAQ9B,OAAO8B,MAL0B;AAMzCI,gCAAQlC,OAAOkC,MAN0B;AAOzCrE,4BAAImC,OAAOnC,EAP8B;AAQzCsE,iCAASnC,OAAOmC;AARyB,qBAA7C;AADU,iBAAd;AAYH,aAhBL;AAiBH,SA1EqB;;AAAA,cA4EtBG,cA5EsB,GA4EL,YAAM;AACnB,kBAAK3B,OAAL,GACKI,IADL,CACU,MAAKwB,mBADf;AAEH,SA/EqB;;AAAA,cAiFtBC,cAjFsB,GAiFL;AAAA,mBAAQ,YAAM;AAC3B,sBAAKtB,QAAL,CAAc;AACVuB,gCAAY,IADF;AAEVC,kCAAclB;AAFJ,iBAAd;AAIA,sBAAKV,KAAL,CAAWR,eAAX,4BAAgCkB,IAAhC,IAAsCW,SAAS,IAA/C,KAAuDpB,IAAvD,CAA4D,MAAKJ,OAAL,EAA5D;AACA,sBAAKG,KAAL,CAAWN,uBAAX;AACH,aAPgB;AAAA,SAjFK;;AAAA,cA0FtB+B,mBA1FsB,GA0FA,YAAM;AACxB,kBAAKrB,QAAL,CAAc;AACVuB,4BAAY,KADF;AAEVC,8BAAc;AAFJ,aAAd;AAIH,SA/FqB;;AAAA,cAiGtBC,kBAjGsB,GAiGD,eAAO;AACxB,mBAAO,MAAK7B,KAAL,CAAWP,iBAAX,CAA6BqC,GAA7B,EACF7B,IADE,CACG,YAAM;AACR,sBAAKJ,OAAL;AACA,sBAAKG,KAAL,CAAWN,uBAAX;AACH,aAJE,CAAP;AAKH,SAvGqB;;AAGlB,cAAK6B,KAAL,GAAa;AACTlB,qBAAS,IADA;AAETsB,wBAAY,KAFH;AAGTC,0BAAc;AAHL,SAAb;AAKA,cAAKG,UAAL,GAAkB,CACd,EAAEC,MAAM;AAAA;;AAAA,uBAAQ;AAAA;AAAA,8CAAK,WAAW,MAAKhC,KAAL,CAAWiC,OAAX,CAAmBvD,UAAnC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAgD,0CAAO,CAAC,MAAD,CAAP,EAAiB,EAAjB,EAAqBgC,IAArB,CAAhD;AAAA;AAA6E,0CAAO,CAAC,SAAD,CAAP,EAAoB,EAApB,EAAwBA,IAAxB;AAA7E,iBAAR;AAAA,aAAR,EADc,EAEd,EAAEsB,MAAM;AAAA;;AAAA,uBAAQ;AAAA;AAAA,+CAAK,WAAW,MAAKhC,KAAL,CAAWiC,OAAX,CAAmBvD,UAAnC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAgD,0CAAO,CAAC,QAAD,CAAP,EAAmB,EAAnB,EAAuBgC,IAAvB;AAAhD,iBAAR;AAAA,aAAR,EAFc,EAGd,EAAEsB,MAAM;AAAA;;AAAA,uBAAQ;AAAA;AAAA,+CAAK,WAAW,MAAKhC,KAAL,CAAWiC,OAAX,CAAmBvD,UAAnC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAgD,0CAAO,CAAC,QAAD,CAAP,EAAmB,EAAnB,EAAuBgC,IAAvB;AAAhD,iBAAR;AAAA,aAAR,EAHc,CAAlB;AARkB;AAarB;;;;4CAiCoB;AACjBwB,sCAA0BC,MAA1B,CAAiCC,EAAjC,CAAoC,QAApC,EAA8C,KAAKd,MAAnD;;AAEA,iBAAKzB,OAAL;AACH;;;+CAEuB;AACpBqC,sCAA0BC,MAA1B,CAAiCE,cAAjC,CAAgD,QAAhD,EAA0D,KAAKf,MAA/D;AACH;;;iCAmDS;AAAA;;AAAA,gBACEW,OADF,GACc,KAAKjC,KADnB,CACEiC,OADF;AAAA,yBAEuD,KAAKV,KAF5D;AAAA,gBAEElB,OAFF,UAEEA,OAFF;AAAA,gBAEWuB,YAFX,UAEWA,YAFX;AAAA,gBAEyBD,UAFzB,UAEyBA,UAFzB;AAAA,gBAEqCrB,aAFrC,UAEqCA,aAFrC;;;AAIN,gBAAID,OAAJ,EAAa;AAAA;;AACT,uBAAO;AAAA;AAAA,+CAAK,WAAW4B,QAAQ/E,MAAxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACH,kDAAC,0BAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADG,iBAAP;AAGH;;AAED,mBAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACH,8CAAC,oBAAD;AACI,gCAAYJ,UADhB;AAEI,gCAAY,KAAKiF,UAFrB;AAGI,4BAAQzB,cAAcgC,IAAd,CAAmB,UAACC,IAAD,EAAOC,IAAP;AAAA,+BAAgBA,KAAKrB,aAAL,GAAqBoB,KAAKpB,aAA1C;AAAA,qBAAnB,CAHZ;AAII,gCAAW,wFAJf;AAKI,6CAAwB,mKAL5B;AAMI,8CAAyB,yKAN7B;AAOI,8BAAU,KAAKU,kBAPnB;AAQI,gCAAY,KAAKH,cARrB;AASI,iCAAa,KATjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oSADG;AAYH;AAAC,mCAAD;AAAA,+CAAO,MAAMC,UAAb,EAAyB,SAAS,KAAKF,mBAAvC,EAA4D,WAAWQ,QAAQ1E,KAA/E,EAAsF,yBAAtF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACI;AAAC,uCAAD;AAAA,mDAAO,WAAW0E,QAAQzE,YAA1B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACI,sDAAC,yBAAD,6BAAiB,MAAMoE,YAAvB,EAAqC,QAAQ,KAAKJ,cAAlD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADJ;AADJ;AAZG,aAAP;AAkBH;;;EA/I0BiB,gB,UACpBC,S,GAAY;AACfT,aAASU,oBAAUC,MAAV,CAAiBC,UADX;AAEfxD,cAAUsD,oBAAUG,IAAV,CAAeD,UAFV;AAGftD,oBAAgBoD,oBAAUG,IAAV,CAAeD,UAHhB;AAIfrD,qBAAiBmD,oBAAUG,IAAV,CAAeD,UAJjB;AAKfpD,uBAAmBkD,oBAAUG,IAAV,CAAeD,UALnB;AAMfnD,6BAAyBiD,oBAAUG,IAAV,CAAeD;AANzB,C;kBAiJR,yBAAQ7D,eAAR,EAAyBG,kBAAzB,EAA6C,wBAAWlC,cAAX,EAA2B0C,gBAA3B,CAA7C,C","file":"TransactionsPage.jsx","sourceRoot":"C:\\Users\\cherv\\OneDrive\\Рабочий стол\\deltaway.20","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\n\nimport pathOr from '@tinkoff/utils/object/pathOr';\n\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport Modal from '@material-ui/core/Modal';\nimport Paper from '@material-ui/core/Paper';\nimport { withStyles } from '@material-ui/core/styles';\n\nimport AdminTable from '../../components/AdminTable/AdminTable.jsx';\nimport MoneyOutputForm from '../../components/MoneyOutputForm/MoneyOutputForm.jsx';\n\nimport { connect } from 'react-redux';\nimport getUsers from '../../../services/getUsers';\nimport getMoneyOutput from '../../../services/getMoneyOutput';\nimport editMoneyOutput from '../../../services/editMoneyOutput';\nimport deleteMoneyOutput from '../../../services/deleteOutputsByIds';\nimport outputWebsocketController from '../../../services/outputWebsocket';\nimport getUnvisitedMoneyOutput from '../../../services/getUnvisitedMoneyOutput';\n\nconst headerRows = [\n    { id: 'name', label: 'Имя' },\n    { id: 'amount', label: 'Сумма' },\n    { id: 'status', label: 'Статус' }\n];\n\nconst materialStyles = theme => ({\n    loader: {\n        height: 'calc(100vh - 64px)',\n        display: 'flex',\n        justifyContent: 'center',\n        alignItems: 'center'\n    },\n    modal: {\n        display: 'flex',\n        justifyContent: 'center',\n        alignItems: 'center'\n    },\n    modalContent: {\n        position: 'absolute',\n        width: '1200px',\n        backgroundColor: theme.palette.background.paper,\n        boxShadow: theme.shadows[5],\n        padding: theme.spacing.unit * 4,\n        outline: 'none',\n        overflowY: 'auto',\n        maxHeight: '100vh',\n        '@media (max-width:1300px)': {\n            width: '90%'\n        }\n    },\n    warningContent: {\n        paddingBottom: '0'\n    },\n    columnName: {\n        maxWidth: '400px',\n        whiteSpace: 'nowrap',\n        overflow: 'hidden',\n        textOverflow: 'ellipsis',\n        '@media (max-width:1020px)': {\n            maxWidth: '200px'\n        },\n        '@media (max-width:750px)': {\n            maxWidth: '100px'\n        },\n        '@media (max-width:340px)': {\n            maxWidth: '80px'\n        }\n    },\n    columnAlias: {\n        maxWidth: '200px',\n        display: 'block',\n        whiteSpace: 'nowrap',\n        overflow: 'hidden',\n        textOverflow: 'ellipsis',\n        '@media (max-width:850px)': {\n            maxWidth: '100px'\n        },\n        '@media (max-width:400px)': {\n            maxWidth: '50px'\n        }\n    }\n});\n\nconst mapStateToProps = ({ data }) => {\n    return {\n        output: data.output\n    };\n};\n\nconst mapDispatchToProps = (dispatch) => ({\n    getUsers: payload => dispatch(getUsers(payload)),\n    getMoneyOutput: payload => dispatch(getMoneyOutput(payload)),\n    editMoneyOutput: payload => dispatch(editMoneyOutput(payload)),\n    deleteMoneyOutput: payload => dispatch(deleteMoneyOutput(payload)),\n    getUnvisitedMoneyOutput: payload => dispatch(getUnvisitedMoneyOutput(payload))\n});\n\nclass TransactionsPage extends Component {\n    static propTypes = {\n        classes: PropTypes.object.isRequired,\n        getUsers: PropTypes.func.isRequired,\n        getMoneyOutput: PropTypes.func.isRequired,\n        editMoneyOutput: PropTypes.func.isRequired,\n        deleteMoneyOutput: PropTypes.func.isRequired,\n        getUnvisitedMoneyOutput: PropTypes.func.isRequired\n    };\n\n    constructor (...args) {\n        super(...args);\n\n        this.state = {\n            loading: true,\n            formShowed: false,\n            editableUser: null\n        };\n        this.tableCells = [\n            { prop: user => <div className={this.props.classes.columnName}>{pathOr(['name'], '', user)} {pathOr(['surname'], '', user)}</div> },\n            { prop: user => <div className={this.props.classes.columnName}>{pathOr(['amount'], '', user)}</div> },\n            { prop: user => <div className={this.props.classes.columnName}>{pathOr(['status'], '', user)}</div> }\n        ];\n    }\n\n    getData = () => {\n        return Promise.all([\n            this.props.getMoneyOutput(),\n            this.props.getUsers(false)\n        ])\n            .then(([outputs, users]) => {\n                this.setState({\n                    loading: false,\n                    outputByUsers:\n                        outputs.payload.reduce((acc, item) => {\n                            const user = users.payload.find((user) => { return user.id === item.userId; });\n\n                            if (user) {\n                                acc.push({\n                                    name: user.name,\n                                    surname: user.surname,\n                                    status: item.status,\n                                    date: item.createdAt,\n                                    createdAtDate: item.createdAtDate,\n                                    amount: item.amount,\n                                    id: item.id,\n                                    visited: item.visited\n                                });\n                            }\n\n                            return acc;\n                        }, [])\n                });\n            });\n    }\n\n    componentDidMount () {\n        outputWebsocketController.events.on('output', this.qwerty);\n\n        this.getData();\n    }\n\n    componentWillUnmount () {\n        outputWebsocketController.events.removeListener('output', this.qwerty);\n    }\n\n    qwerty = output => {\n        this.props.getUsers(false)\n            .then((users) => {\n                const user = users.payload.find((user) => { return user.id === output.userId; });\n\n                this.setState({\n                    outputByUsers: [...this.state.outputByUsers, {\n                        date: output.createdAt,\n                        createdAtDate: output.createdAtDate,\n                        name: user.name,\n                        surname: user.surname,\n                        status: output.status,\n                        amount: output.amount,\n                        id: output.id,\n                        visited: output.visited\n                    }]\n                });\n            });\n    }\n\n    handleFormDone = () => {\n        this.getData()\n            .then(this.handleCloseUserForm);\n    };\n\n    handleFormOpen = user => () => {\n        this.setState({\n            formShowed: true,\n            editableUser: user\n        });\n        this.props.editMoneyOutput({ ...user, visited: true }).then(this.getData());\n        this.props.getUnvisitedMoneyOutput();\n    };\n\n    handleCloseUserForm = () => {\n        this.setState({\n            formShowed: false,\n            editableUser: null\n        });\n    };\n\n    handleOutputDelete = ids => {\n        return this.props.deleteMoneyOutput(ids)\n            .then(() => {\n                this.getData();\n                this.props.getUnvisitedMoneyOutput();\n            });\n    };\n\n    render () {\n        const { classes } = this.props;\n        const { loading, editableUser, formShowed, outputByUsers } = this.state;\n\n        if (loading) {\n            return <div className={classes.loader}>\n                <CircularProgress />\n            </div>;\n        }\n\n        return <div>\n            <AdminTable\n                headerRows={headerRows}\n                tableCells={this.tableCells}\n                values={outputByUsers.sort((prev, next) => next.createdAtDate - prev.createdAtDate)}\n                headerText='Запросы на вывод'\n                deleteValueWarningTitle='Вы точно хотите удалить запрос?'\n                deleteValuesWarningTitle='Вы точно хотите удалить запросы?'\n                onDelete={this.handleOutputDelete}\n                onFormOpen={this.handleFormOpen}\n                isAddButton={false}\n            />\n            <Modal open={formShowed} onClose={this.handleCloseUserForm} className={classes.modal} disableEnforceFocus>\n                <Paper className={classes.modalContent}>\n                    <MoneyOutputForm user={editableUser} onDone={this.handleFormDone} />\n                </Paper>\n            </Modal>\n        </div>;\n    }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(withStyles(materialStyles)(TransactionsPage));\n"]}]}