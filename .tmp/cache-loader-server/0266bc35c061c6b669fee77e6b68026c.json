{"remainingRequest":"/Users/dimasabitov/Downloads/deltaway.20/node_modules/babel-loader/lib/index.js??ref--5-2!/Users/dimasabitov/Downloads/deltaway.20/server/api/client/user/services/removeOtherDoc.js","dependencies":[{"path":"/Users/dimasabitov/Downloads/deltaway.20/server/api/client/user/services/removeOtherDoc.js","mtime":1671546377768},{"path":"/Users/dimasabitov/Downloads/deltaway.20/.babelrc","mtime":1671546158632},{"path":"/Users/dimasabitov/Downloads/deltaway.20/node_modules/cache-loader/dist/cjs.js","mtime":1671546959174},{"path":"/Users/dimasabitov/Downloads/deltaway.20/node_modules/babel-loader/lib/index.js","mtime":1671546957682}],"contextDependencies":[],"result":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _extends2 = require('babel-runtime/helpers/extends');\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nexports.default = removeOtherDoc;\n\nvar _fs = require('fs');\n\nvar _fs2 = _interopRequireDefault(_fs);\n\nvar _path = require('path');\n\nvar _path2 = _interopRequireDefault(_path);\n\nvar _constants = require('../../../../constants/constants');\n\nvar _editUser = require('../queries/editUser');\n\nvar _editUser2 = _interopRequireDefault(_editUser);\n\nvar _remove = require('@tinkoff/utils/array/remove');\n\nvar _remove2 = _interopRequireDefault(_remove);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction removeOtherDoc(req, res) {\n    try {\n        var index = req.body.index;\n        var id = res.locals.user.id;\n\n\n        var othersDoc = res.locals.user.docs.others;\n\n        if (!othersDoc || !othersDoc[index]) {\n            return res.status(_constants.BAD_REQUEST_STATUS_CODE).end();\n        }\n\n        var oldDoc = othersDoc[index];\n        var newDocs = (0, _remove2.default)(index, 1, othersDoc);\n\n        (0, _editUser2.default)({\n            id: id,\n            docs: (0, _extends3.default)({}, res.locals.user.docs, {\n                others: !newDocs.length ? null : newDocs\n            }),\n            updatedAt: Date.now()\n        }).then(function (user) {\n            var oldDocPathFs = _path2.default.join(__dirname, '..', oldDoc.path);\n\n            _fs2.default.unlinkSync(oldDocPathFs);\n            return res.status(_constants.OKEY_STATUS_CODE).send({\n                user: user\n            });\n        }).catch(function () {\n            res.status(_constants.SERVER_ERROR_STATUS_CODE).end();\n        });\n    } catch (e) {\n        res.status(_constants.SERVER_ERROR_STATUS_CODE).end();\n    }\n}\nremoveOtherDoc.i = 'removeOtherDoc';\nremoveOtherDoc.i = 'removeOtherDoc';",null]}