{"remainingRequest":"C:\\Users\\cherv\\OneDrive\\Рабочий стол\\deltaway.20\\node_modules\\babel-loader\\lib\\index.js??ref--5-2!C:\\Users\\cherv\\OneDrive\\Рабочий стол\\deltaway.20\\server\\api\\client\\user\\services\\uploadDoc.js","dependencies":[{"path":"C:\\Users\\cherv\\OneDrive\\Рабочий стол\\deltaway.20\\server\\api\\client\\user\\services\\uploadDoc.js","mtime":1671546376000},{"path":"C:\\Users\\cherv\\OneDrive\\Рабочий стол\\deltaway.20\\.babelrc","mtime":1671546158000},{"path":"C:\\Users\\cherv\\OneDrive\\Рабочий стол\\deltaway.20\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1671546958000},{"path":"C:\\Users\\cherv\\OneDrive\\Рабочий стол\\deltaway.20\\node_modules\\babel-loader\\lib\\index.js","mtime":1671546956000}],"contextDependencies":[],"result":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _defineProperty2 = require('babel-runtime/helpers/defineProperty');\n\nvar _defineProperty3 = _interopRequireDefault(_defineProperty2);\n\nvar _toConsumableArray2 = require('babel-runtime/helpers/toConsumableArray');\n\nvar _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);\n\nvar _extends2 = require('babel-runtime/helpers/extends');\n\nvar _extends3 = _interopRequireDefault(_extends2);\n\nexports.default = updateDoc;\n\nvar _fs = require('fs');\n\nvar _fs2 = _interopRequireDefault(_fs);\n\nvar _includes = require('@tinkoff/utils/array/includes');\n\nvar _includes2 = _interopRequireDefault(_includes);\n\nvar _multipart = require('../../../../helpers/multipart');\n\nvar _multipart2 = _interopRequireDefault(_multipart);\n\nvar _constants = require('../../../../constants/constants');\n\nvar _editUser = require('../queries/editUser');\n\nvar _editUser2 = _interopRequireDefault(_editUser);\n\nvar _getUserById = require('../queries/getUserById');\n\nvar _getUserById2 = _interopRequireDefault(_getUserById);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar uploader = (0, _multipart2.default)();\n\nfunction updateDoc(req, res) {\n    try {\n        uploader(req, res, function (err) {\n            if (err || !req.files[0]) {\n                return res.status(_constants.SERVER_ERROR_STATUS_CODE).end();\n            }\n\n            var file = req.files[0];\n            var filePath = '/' + file.path.replace(/\\\\/g, '/');\n            var docName = req.body.docName;\n\n\n            if (!(0, _includes2.default)(docName, _constants.DOC_NAMES)) {\n                _fs2.default.unlinkSync(filePath);\n                return res.status(_constants.BAD_REQUEST_STATUS_CODE).end();\n            }\n\n            var id = res.locals.user.id;\n\n\n            (0, _editUser2.default)({\n                id: id,\n                docs: (0, _extends3.default)({}, res.locals.user.docs, docName === 'others' ? { others: [].concat((0, _toConsumableArray3.default)(res.locals.user.docs.others || []), [{ path: filePath, name: file.originalname }]) } : (0, _defineProperty3.default)({}, docName, { path: filePath, name: file.originalname })),\n                updatedAt: Date.now()\n            }).then(function () {\n                (0, _getUserById2.default)(id).then(function () {\n                    (0, _editUser2.default)({ id: id }).then(function (user) {\n                        return res.status(_constants.OKEY_STATUS_CODE).send({\n                            user: user\n                        });\n                    }).catch(function () {\n                        res.status(_constants.SERVER_ERROR_STATUS_CODE).end();\n                    });\n                }).catch(function () {\n                    res.status(_constants.SERVER_ERROR_STATUS_CODE).end();\n                });\n            }).catch(function () {\n                res.status(_constants.SERVER_ERROR_STATUS_CODE).end();\n            });\n        });\n    } catch (e) {\n        res.status(_constants.SERVER_ERROR_STATUS_CODE).end();\n    }\n}\nupdateDoc.i = 'updateDoc';\nupdateDoc.i = 'updateDoc';",null]}