{"remainingRequest":"/Users/dimasabitov/Downloads/deltaway.20/node_modules/babel-loader/lib/index.js??ref--5-2!/Users/dimasabitov/Downloads/deltaway.20/server/api/client/order/services/closeAllOrders.js","dependencies":[{"path":"/Users/dimasabitov/Downloads/deltaway.20/server/api/client/order/services/closeAllOrders.js","mtime":1671546390741},{"path":"/Users/dimasabitov/Downloads/deltaway.20/.babelrc","mtime":1671546158632},{"path":"/Users/dimasabitov/Downloads/deltaway.20/node_modules/cache-loader/dist/cjs.js","mtime":1671546959174},{"path":"/Users/dimasabitov/Downloads/deltaway.20/node_modules/babel-loader/lib/index.js","mtime":1671546957682}],"contextDependencies":[],"result":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.default = closeAllOrders;\n\nvar _editOrder = require('../queries/editOrder');\n\nvar _editOrder2 = _interopRequireDefault(_editOrder);\n\nvar _editUser = require('../../user/queries/editUser');\n\nvar _editUser2 = _interopRequireDefault(_editUser);\n\nvar _getOpenedOrdersByUserId = require('../queries/getOpenedOrdersByUserId');\n\nvar _getOpenedOrdersByUserId2 = _interopRequireDefault(_getOpenedOrdersByUserId);\n\nvar _pricesController = require('../../../../controllers/pricesController');\n\nvar _pricesController2 = _interopRequireDefault(_pricesController);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction closeAllOrders(userId) {\n    try {\n        (0, _getOpenedOrdersByUserId2.default)(userId).then(function (orders) {\n            Promise.all(orders.map(function (order) {\n                var closedOrder = {\n                    id: order.id,\n                    isClosed: true,\n                    closedAt: Date.now(),\n                    closedPrice: _pricesController2.default.prices[order.assetName]\n                };\n\n                return (0, _editOrder2.default)(closedOrder);\n            })).then(function () {\n                var updatedUser = {\n                    id: userId,\n                    balance: 0,\n                    bonuses: 0,\n                    credFacilities: 0,\n                    mainBalance: 0\n                };\n                (0, _editUser2.default)(updatedUser).then(function () {});\n            });\n        });\n    } catch (e) {}\n}\ncloseAllOrders.i = 'closeAllOrders';\ncloseAllOrders.i = 'closeAllOrders';",null]}