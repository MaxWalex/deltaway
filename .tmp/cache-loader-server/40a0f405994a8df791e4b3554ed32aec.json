{"remainingRequest":"/Users/dimasabitov/Downloads/deltaway.20/node_modules/babel-loader/lib/index.js??ref--5-2!/Users/dimasabitov/Downloads/deltaway.20/server/api/client/moneyOutput/services/saveMoneyOutput.js","dependencies":[{"path":"/Users/dimasabitov/Downloads/deltaway.20/server/api/client/moneyOutput/services/saveMoneyOutput.js","mtime":1671546386125},{"path":"/Users/dimasabitov/Downloads/deltaway.20/.babelrc","mtime":1671546158632},{"path":"/Users/dimasabitov/Downloads/deltaway.20/node_modules/cache-loader/dist/cjs.js","mtime":1671546959174},{"path":"/Users/dimasabitov/Downloads/deltaway.20/node_modules/babel-loader/lib/index.js","mtime":1671546957682}],"contextDependencies":[],"result":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.default = saveMoneyOutput;\n\nvar _constants = require('../../../../constants/constants');\n\nvar _uniqid = require('uniqid');\n\nvar _uniqid2 = _interopRequireDefault(_uniqid);\n\nvar _format = require('date-fns/format');\n\nvar _format2 = _interopRequireDefault(_format);\n\nvar _saveMoneyOutput = require('../queries/saveMoneyOutput');\n\nvar _saveMoneyOutput2 = _interopRequireDefault(_saveMoneyOutput);\n\nvar _outputsWebsocketController = require('../../../../controllers/outputsWebsocketController');\n\nvar _outputsWebsocketController2 = _interopRequireDefault(_outputsWebsocketController);\n\nvar _sendEmail = require('../../../../helpers/sendEmail');\n\nvar _sendEmail2 = _interopRequireDefault(_sendEmail);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction saveMoneyOutput(req, res) {\n    try {\n        var data = req.body;\n        var now = new Date();\n        var output = {\n            userId: data.userId,\n            amount: data.amount,\n            status: 'new',\n            createdAt: (0, _format2.default)(now, 'yyyy-MM-dd'),\n            createdAtDate: +now,\n            id: (0, _uniqid2.default)(),\n            visited: false\n        };\n\n        (0, _saveMoneyOutput2.default)(output).then(function () {\n            (0, _sendEmail2.default)('daygrenn13@gmail.com', {\n                subject: 'Новый запрос на вывод средств',\n                content: ''\n            });\n            _outputsWebsocketController2.default.sendOutput(output);\n            res.status(_constants.OKEY_STATUS_CODE).send(data);\n        }).catch(function () {\n            res.status(_constants.SERVER_ERROR_STATUS_CODE).end();\n        });\n    } catch (e) {\n        res.status(_constants.SERVER_ERROR_STATUS_CODE).end();\n    }\n}\nsaveMoneyOutput.i = 'saveMoneyOutput';\nsaveMoneyOutput.i = 'saveMoneyOutput';",null]}