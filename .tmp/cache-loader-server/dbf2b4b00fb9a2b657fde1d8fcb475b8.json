{"remainingRequest":"/Users/dimasabitov/Downloads/deltaway.20/node_modules/babel-loader/lib/index.js??ref--5-2!/Users/dimasabitov/Downloads/deltaway.20/src/apps/client/services/client/messageWebsocket.js","dependencies":[{"path":"/Users/dimasabitov/Downloads/deltaway.20/src/apps/client/services/client/messageWebsocket.js","mtime":1671546525170},{"path":"/Users/dimasabitov/Downloads/deltaway.20/.babelrc","mtime":1671546158632},{"path":"/Users/dimasabitov/Downloads/deltaway.20/node_modules/cache-loader/dist/cjs.js","mtime":1671546959174},{"path":"/Users/dimasabitov/Downloads/deltaway.20/node_modules/babel-loader/lib/index.js","mtime":1671546957682}],"contextDependencies":[],"result":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = require('babel-runtime/helpers/createClass');\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _socket = require('socket.io-client');\n\nvar _socket2 = _interopRequireDefault(_socket);\n\nvar _constants = require('../../constants/constants');\n\nvar _eventemitter = require('eventemitter3');\n\nvar _eventemitter2 = _interopRequireDefault(_eventemitter);\n\nvar _constants2 = require('../../../../../server/constants/constants');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar WEBSOCKET_URL = process.env.NODE_ENV === 'production' ? 'wss://' + _constants2.DOMAIN + ':5050' : 'ws://localhost:5050';\n\nvar MessageWebsocketController = function () {\n    function MessageWebsocketController() {\n        (0, _classCallCheck3.default)(this, MessageWebsocketController);\n        this.events = new _eventemitter2.default();\n    }\n\n    (0, _createClass3.default)(MessageWebsocketController, [{\n        key: 'connect',\n        value: function connect() {\n            var _this = this;\n\n            if (this.socket) {\n                return;\n            }\n            var socket = (0, _socket2.default)(WEBSOCKET_URL, { transports: ['websocket'] });\n\n            this.socket = socket;\n\n            socket.on('connect', function () {\n                var token = localStorage.getItem(_constants.TOKEN_CLIENT_LOCAL_STORAGE_NAME);\n\n                socket.emit('token', {\n                    type: 'client',\n                    token: token\n                });\n            });\n\n            socket.on('message', function (data) {\n                _this.events.emit('message', data);\n            });\n\n            socket.on(_constants2.AUTO_CLOSE_ORDER_EVENT, function (data) {\n                return _this.events.emit(_constants2.AUTO_CLOSE_ORDER_EVENT_CLIENT, data);\n            });\n        }\n    }, {\n        key: 'disconnect',\n        value: function disconnect() {\n            this.socket && this.socket.disconnect();\n            this.socket = null;\n        }\n    }, {\n        key: 'sendMessage',\n        value: function sendMessage(_ref) {\n            var text = _ref.text;\n\n            if (!this.socket) {\n                return;\n            }\n\n            this.socket.emit('message', {\n                text: text\n            });\n        }\n    }]);\n    return MessageWebsocketController;\n}();\n\nvar messageWebsocketController = new MessageWebsocketController();\n\nexports.default = messageWebsocketController;\nmessageWebsocketController.i = 'messageWebsocketController';\nmessageWebsocketController.i = 'messageWebsocketController';",null]}